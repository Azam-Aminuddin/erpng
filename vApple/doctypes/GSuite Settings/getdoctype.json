{"docs":[{"fields":[{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Enable","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"d5217a7a1d","idx":1,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"enable","fieldtype":"Check","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Google Credentials","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:doc.enable","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"b5f21c7906","idx":2,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"google_credentials","fieldtype":"Section Break","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Client ID","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"c9ee22cfc2","idx":3,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"client_id","fieldtype":"Data","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Client Secret","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"03decda3c7","idx":4,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"client_secret","fieldtype":"Password","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Allow GSuite access","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:(doc.client_secret && doc.client_id)","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"0ffaf7a6b6","idx":5,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"allow_gsuite_access","fieldtype":"Button","report_hide":0,"parentfield":"fields"},{"collapsible":1,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Google Apps Script","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:doc.enable","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"76a03eceac","idx":6,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"google_apps_script","fieldtype":"Section Break","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"description":"If you aren't using own publish Google Apps Script webapp you can use the default https://script.google.com/macros/s/AKfycbxIFOx3301xwtF2IFPJ4pUQGqkNF3hBiBebppWkeKn6fKZRQvk/exec ","read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Script URL","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"f980e5572a","idx":7,"default":"https://script.google.com/macros/s/AKfycbxIFOx3301xwtF2IFPJ4pUQGqkNF3hBiBebppWkeKn6fKZRQvk/exec","in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"script_url","fieldtype":"Data","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"description":"Copy and paste this code into and empty Code.gs in your project at script.google.com","read_only":1,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Script Code","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"eff424038d","idx":8,"default":"","in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"script_code","fieldtype":"HTML","options":"<code>// ERPNEXT GSuite integration\n//\n\nfunction doGet(e){\n  return ContentService.createTextOutput('ok');\n}\n\nfunction doPost(e) {\n  var p = JSON.parse(e.postData.contents);\n\n  switch(p.exec){\n    case 'new':\n      var url = createDoc(p);\n      result = { 'url': url };\n      break;\n    case 'test':\n      result = { 'test':'ping' , 'version':'1.0'}\n  }\n  return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);\n}\n\nfunction replaceVars(body,p){\n  for (key in p) {\n    if (p.hasOwnProperty(key)) {\n      if (p[key] != null) {\n        body.replaceText('{{'+key+'}}', p[key]);\n      }\n    }\n  }    \n}\n\nfunction createDoc(p) {\n  if(p.destination){\n    var folder = DriveApp.getFolderById(p.destination);\n  } else {\n    var folder = DriveApp.getRootFolder();\n  }\n  var template = DriveApp.getFileById( p.template )\n  var newfile = template.makeCopy( p.filename , folder );\n\n  switch(newfile.getMimeType()){\n    case MimeType.GOOGLE_DOCS:\n      var body = DocumentApp.openById(newfile.getId()).getBody();\n      replaceVars(body,p.vars);\n      break;\n    case MimeType.GOOGLE_SHEETS:\n      //TBD\n    case MimeType.GOOGLE_SLIDES:\n      //TBD\n  }\n  return newfile.getUrl()\n}\n\n</code>","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":1,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":1,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Run Script Test","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:(doc.client_id && doc.client_secret && doc.authorization_code && doc.refresh_token && doc.script_url)","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"6533c46f3f","idx":9,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"run_script_test","fieldtype":"Button","report_hide":1,"parentfield":"fields"},{"collapsible":0,"no_copy":1,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":1,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"refresh_token","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":1,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"6dba776528","idx":10,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"refresh_token","fieldtype":"Password","report_hide":1,"parentfield":"fields"},{"collapsible":0,"no_copy":1,"creation":"2017-04-21 16:57:30.264478","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":1,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Authorization Code","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":1,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"GSuite Settings","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"a23d487a47","idx":11,"in_standard_filter":0,"modified":"2017-09-29 01:32:31.116284","parenttype":"DocType","fieldname":"authorization_code","fieldtype":"Password","report_hide":1,"parentfield":"fields"}],"image_view":0,"allow_import":0,"creation":"2017-04-21 16:57:30.264478","__list_js":null,"track_changes":1,"track_seen":0,"sort_order":"DESC","__linked_with":null,"owner":"Administrator","editable_grid":1,"__form_grid_templates":null,"in_create":1,"read_only":1,"__templates":null,"document_type":"System","hide_heading":0,"modified_by":"Administrator","allow_rename":0,"__kanban_column_fields":[],"custom":0,"max_attachments":0,"__js":"\n\n/* Adding /home/frappe/frappe-bench/apps/frappe/frappe/integrations/doctype/gsuite_settings/gsuite_settings.js */\n\n// Copyright (c) 2017, Frappe Technologies and contributors\n// For license information, please see license.txt\n\nfrappe.ui.form.on('GSuite Settings', {\n\trefresh: function(frm) {\n\t\tfrm.clear_custom_buttons();\n\t},\n\n\tallow_gsuite_access: function(frm) {\n\t\tif (frm.doc.client_id && frm.doc.client_secret) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.integrations.doctype.gsuite_settings.gsuite_settings.gsuite_callback\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrm.save();\n\t\t\t\t\t\twindow.open(r.message.url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.msgprint(__(\"Please enter values for GSuite Access Key and GSuite Access Secret\"))\n\t\t}\n\t},\n\trun_script_test: function(frm) {\n\t\tif (frm.doc.client_id && frm.doc.client_secret) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.integrations.doctype.gsuite_settings.gsuite_settings.run_script_test\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (r.message == 'ping') {\n\t\t\t\t\t\t\tfrappe.msgprint(__('GSuite test executed with success. GSuite integration is correctly configured'),__('GSuite script test'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.msgprint(__(\"Please enter values for GSuite Access Key and GSuite Access Secret\"));\n\t\t}\n\t}\n});\n","__tree_js":null,"docstatus":0,"sort_field":"modified","__messages":null,"allow_copy":1,"engine":"InnoDB","allow_guest_to_view":0,"istable":0,"has_web_view":0,"__map_js":null,"__css":null,"show_name_in_global_search":0,"beta":0,"read_only_onload":0,"module":"Integrations","doctype":"DocType","__dashboard":{},"__kanban_boards":[],"issingle":1,"__listview_template":null,"name":"GSuite Settings","idx":0,"hide_toolbar":0,"__workflow_docs":[],"modified":"2017-05-19 15:28:44.663715","is_submittable":0,"name_case":"","__calendar_js":null,"permissions":[{"creation":"2017-04-21 16:57:30.264478","share":1,"doctype":"DocPerm","owner":"Administrator","export":0,"cancel":0,"set_user_permissions":0,"modified_by":"Administrator","create":1,"submit":0,"write":1,"role":"System Manager","print":1,"docstatus":0,"permlevel":0,"parent":"GSuite Settings","read":1,"import":0,"report":0,"apply_user_permissions":0,"name":"323679fb5d","idx":1,"amend":0,"modified":"2017-09-29 01:32:31.116284","email":1,"parenttype":"DocType","parentfield":"permissions","if_owner":0,"delete":1}],"quick_entry":1,"__custom_js":"","__print_formats":[]}],"user_settings":"{}"}
{"docs":[{"fields":[{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Based On","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"3ad4b0957b","idx":1,"default":"","in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"based_on","fieldtype":"Select","options":"Student Group\nCourse Schedule","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Group Based On","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:doc.based_on == \"Student Group\"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"0ff702a65b","idx":2,"default":"Batch","in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"group_based_on","fieldtype":"Select","options":"Batch\nCourse\nActivity","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"33a46c8786","idx":3,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"column_break_2","fieldtype":"Column Break","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":["program","batch","course"],"doctype":"DocField","owner":"Administrator","in_list_view":1,"reqd":1,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Student Group","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":"Document","set_only_once":0,"depends_on":"eval:doc.based_on ==\"Student Group\"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"cbf7d51181","idx":4,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"student_group","fieldtype":"Link","options":"Student Group","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":1,"reqd":1,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Course Schedule","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":"Document","set_only_once":0,"depends_on":"eval:doc.based_on ==\"Course Schedule\"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"d4c9d7466e","idx":5,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"course_schedule","fieldtype":"Link","options":"Course Schedule","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":1,"reqd":1,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Date","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval:doc.based_on ==\"Student Group\"","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"154fdf29d5","idx":6,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"date","fieldtype":"Date","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Attendance","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"depends_on":"eval: (doc.course_schedule \n|| (doc.student_group && doc.date))","docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"6a59362b0f","idx":7,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"attendance","fieldtype":"Section Break","report_hide":0,"parentfield":"fields"},{"collapsible":0,"no_copy":0,"creation":"2016-11-16 17:12:46.437539","search_fields":null,"doctype":"DocField","owner":"Administrator","in_list_view":0,"reqd":0,"ignore_xss_filter":0,"in_global_search":0,"read_only":0,"print_hide":0,"modified_by":"Administrator","ignore_user_permissions":0,"length":0,"label":"Students HTML","print_hide_if_no_value":0,"allow_bulk_edit":0,"linked_document_type":null,"set_only_once":0,"docstatus":0,"hidden":0,"in_filter":0,"permlevel":0,"columns":0,"bold":0,"parent":"Student Attendance Tool","search_index":0,"allow_on_submit":0,"precision":"","is_custom_field":null,"remember_last_selected_value":0,"unique":0,"name":"002410e284","idx":8,"in_standard_filter":0,"modified":"2017-09-29 01:32:45.924064","parenttype":"DocType","fieldname":"students_html","fieldtype":"HTML","report_hide":0,"parentfield":"fields"}],"image_view":0,"allow_import":0,"creation":"2016-11-16 17:12:46.437539","__list_js":null,"track_changes":0,"track_seen":0,"sort_order":"DESC","__linked_with":null,"owner":"Administrator","editable_grid":1,"__form_grid_templates":null,"in_create":0,"read_only":0,"__templates":null,"document_type":"","hide_heading":1,"modified_by":"Administrator","allow_rename":0,"__kanban_column_fields":[],"custom":0,"max_attachments":0,"__js":"\n\n/* Adding /home/frappe/frappe-bench/apps/erpnext/erpnext/schools/doctype/student_attendance_tool/student_attendance_tool.js */\n\n// Copyright (c) 2016, Frappe Technologies Pvt. Ltd. and contributors\n// For license information, please see license.txt\nfrappe.provide(\"schools\")\n\nfrappe.ui.form.on('Student Attendance Tool', {\n\tonload: function(frm) {\n\t\tfrm.set_query(\"student_group\", function() {\n\t\t\treturn {\n\t\t\t\t\"filters\": {\n\t\t\t\t\t\"group_based_on\": frm.doc.group_based_on\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\trefresh: function(frm) {\n\t\tif (frappe.route_options) {\n\t\t\tfrm.set_value(\"based_on\", frappe.route_options.based_on);\n\t\t\tfrm.set_value(\"student_group\", frappe.route_options.student_group);\n\t\t\tfrm.set_value(\"course_schedule\", frappe.route_options.course_schedule);\n\t\t\tfrappe.route_options = null;\n\t\t}\n\t\tfrm.disable_save();\n\t},\n\n\tbased_on: function(frm) {\n\t\tif (frm.doc.based_on == \"Student Group\") {\n\t\t\tfrm.set_value(\"course_schedule\", \"\");\n\t\t} else {\n\t\t\tfrm.set_value(\"student_group\", \"\");\n\t\t}\n\t},\n\n\tstudent_group: function(frm) {\n\t\tif ((frm.doc.student_group && frm.doc.date) || frm.doc.course_schedule) {\n\t\t\tvar method = \"erpnext.schools.doctype.student_attendance_tool.student_attendance_tool.get_student_attendance_records\";\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: method,\n\t\t\t\targs: {\n\t\t\t\t\tbased_on: frm.doc.based_on,\n\t\t\t\t\tstudent_group: frm.doc.student_group,\n\t\t\t\t\tdate: frm.doc.date,\n\t\t\t\t\tcourse_schedule: frm.doc.course_schedule\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrm.events.get_students(frm, r.message);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tdate: function(frm) {\n\t\tfrm.trigger(\"student_group\");\n\t},\n\n\tcourse_schedule: function(frm) {\n\t\tfrm.trigger(\"student_group\");\n\t},\n\n\tget_students: function(frm, students) {\n\t\tif (!frm.students_area) {\n\t\t\tfrm.students_area = $('<div>')\n\t\t\t\t.appendTo(frm.fields_dict.students_html.wrapper);\n\t\t}\n\t\tstudents = students || [];\n\t\tfrm.students_editor = new schools.StudentsEditor(frm, frm.students_area, students)\n\t}\n});\n\n\nschools.StudentsEditor = Class.extend({\n\tinit: function(frm, wrapper, students) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.frm = frm;\n\t\tif(students.length > 0) {\n\t\t\tthis.make(frm, students);\n\t\t} else {\n\t\t\tthis.show_empty_state();\n\t\t}\n\t},\n\tmake: function(frm, students) {\n\t\tvar me = this;\n\n\t\t$(this.wrapper).empty();\n\t\tvar student_toolbar = $('<p>\\\n\t\t\t<button class=\"btn btn-default btn-add btn-xs\" style=\"margin-right: 5px;\"></button>\\\n\t\t\t<button class=\"btn btn-xs btn-default btn-remove\" style=\"margin-right: 5px;\"></button>\\\n\t\t\t<button class=\"btn btn-default btn-primary btn-mark-att btn-xs\"></button></p>').appendTo($(this.wrapper));\n\n\t\tstudent_toolbar.find(\".btn-add\")\n\t\t\t.html(__('Check all'))\n\t\t\t.on(\"click\", function() {\n\t\t\t\t$(me.wrapper).find('input[type=\"checkbox\"]').each(function(i, check) {\n\t\t\t\t\tif (!$(check).prop(\"disabled\")) {\n\t\t\t\t\t\tcheck.checked = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\tstudent_toolbar.find(\".btn-remove\")\n\t\t\t.html(__('Uncheck all'))\n\t\t\t.on(\"click\", function() {\n\t\t\t\t$(me.wrapper).find('input[type=\"checkbox\"]').each(function(i, check) {\n\t\t\t\t\tif (!$(check).prop(\"disabled\")) {\n\t\t\t\t\t\tcheck.checked = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\tstudent_toolbar.find(\".btn-mark-att\")\n\t\t\t.html(__('Mark Attendance'))\n\t\t\t.on(\"click\", function() {\n\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", true);\n\t\t\t\tvar studs = [];\n\t\t\t\t$(me.wrapper.find('input[type=\"checkbox\"]')).each(function(i, check) {\n\t\t\t\t\tvar $check = $(check);\n\t\t\t\t\tstuds.push({\n\t\t\t\t\t\tstudent: $check.data().student,\n\t\t\t\t\t\tstudent_name: $check.data().studentName,\n\t\t\t\t\t\tgroup_roll_number: $check.data().group_roll_number,\n\t\t\t\t\t\tdisabled: $check.prop(\"disabled\"),\n\t\t\t\t\t\tchecked: $check.is(\":checked\")\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tvar students_present = studs.filter(function(stud) {\n\t\t\t\t\treturn !stud.disabled && stud.checked;\n\t\t\t\t});\n\n\t\t\t\tvar students_absent = studs.filter(function(stud) {\n\t\t\t\t\treturn !stud.disabled && !stud.checked;\n\t\t\t\t});\n\n\t\t\t\tfrappe.confirm(__(\"Do you want to update attendance?<br>Present: {0}\\\n\t\t\t\t\t<br>Absent: {1}\", [students_present.length, students_absent.length]),\n\t\t\t\t\tfunction() {\t//ifyes\n\t\t\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.schools.api.mark_attendance\",\n\t\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\t\tfreeze_message: \"Marking attendance\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\"students_present\": students_present,\n\t\t\t\t\t\t\t\t\t\"students_absent\": students_absent,\n\t\t\t\t\t\t\t\t\t\"student_group\": frm.doc.student_group,\n\t\t\t\t\t\t\t\t\t\"course_schedule\": frm.doc.course_schedule,\n\t\t\t\t\t\t\t\t\t\"date\": frm.doc.date\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", false);\n\t\t\t\t\t\t\t\t\tfrm.trigger(\"student_group\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\t//ifno\n\t\t\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", false);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tvar htmls = students.map(function(student) {\n\t\t\treturn frappe.render_template(\"student_button\", {\n\t\t\t\tstudent: student.student,\n\t\t\t\tstudent_name: student.student_name,\n\t\t\t\tgroup_roll_number: student.group_roll_number,\n\t\t\t\tstatus: student.status\n\t\t\t})\n\t\t});\n\n\t\t$(htmls.join(\"\")).appendTo(me.wrapper);\n\t},\n\n\tshow_empty_state: function() {\n\t\t$(this.wrapper).html(\n\t\t\t`<div class=\"text-center text-muted\" style=\"line-height: 100px;\">\n\t\t\t\t${__(\"No Students in\")} ${this.frm.doc.student_group}\n\t\t\t</div>`\n\t\t);\n\t}\n});","__tree_js":null,"docstatus":0,"sort_field":"modified","__messages":null,"allow_copy":1,"engine":"InnoDB","allow_guest_to_view":0,"istable":0,"has_web_view":0,"__map_js":null,"__css":null,"show_name_in_global_search":0,"beta":0,"read_only_onload":0,"module":"Schools","doctype":"DocType","__dashboard":{},"__kanban_boards":[],"issingle":1,"__listview_template":null,"name":"Student Attendance Tool","idx":0,"hide_toolbar":1,"__workflow_docs":[],"modified":"2017-06-30 08:21:51.390809","is_submittable":0,"name_case":"","__calendar_js":null,"restrict_to_domain":"Education","permissions":[{"creation":"2016-11-16 17:12:46.437539","share":0,"doctype":"DocPerm","owner":"Administrator","export":0,"cancel":0,"set_user_permissions":0,"modified_by":"Administrator","create":1,"submit":0,"write":1,"role":"Instructor","print":0,"docstatus":0,"permlevel":0,"parent":"Student Attendance Tool","read":1,"import":0,"report":0,"apply_user_permissions":0,"name":"a84123a5f4","idx":1,"amend":0,"modified":"2017-09-29 01:32:45.924064","email":0,"parenttype":"DocType","parentfield":"permissions","if_owner":0,"delete":0},{"creation":"2016-11-16 17:12:46.437539","share":1,"doctype":"DocPerm","owner":"Administrator","export":0,"cancel":0,"set_user_permissions":0,"modified_by":"Administrator","create":1,"submit":0,"write":1,"role":"Academics User","print":1,"docstatus":0,"permlevel":0,"parent":"Student Attendance Tool","read":1,"import":0,"report":0,"apply_user_permissions":0,"name":"0a628fdade","idx":2,"amend":0,"modified":"2017-09-29 01:32:45.924064","email":1,"parenttype":"DocType","parentfield":"permissions","if_owner":0,"delete":0}],"quick_entry":0,"__custom_js":"","__print_formats":[]}],"user_settings":"{}"}
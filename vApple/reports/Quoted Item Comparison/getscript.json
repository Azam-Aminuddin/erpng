{"message":{"html_format":"\n<head>\n\t\n\t\n\t<link href=\"/assets/frappe/css/c3.min.css\" rel=\"stylesheet\" type=\"text/css\">\n\t\n\t\n\t<script type=\"text/javascript\" src=\"/assets/frappe/js/lib/d3.min.js\"></script>\n\t<script type=\"text/javascript\" src=\"/assets/frappe/js/lib/c3.min.js\"></script>\n    <script type=\"text/javascript\">\n\n\t\tonReady(\"#chart_div\", function() {\n\t\t\tvar chartData = [];\n\t\t\t{% var q = 0; %}\n\t\t\t{% for(var j=0, m=data.length+1; j<m; j++) { %}\n\t\t\t\n\t\t\t\tvar tempData{%=j%} = [];\n\t\t\t\t\n\t\t\t\t{% for(var i=1, l=report.columns.length; i<l; i++) { %}\n\t\t\t\t\t{% if(__(report.columns[i].label) != __(\"Quotation\")) { %}\n\t\t\t\t\t\n\t\t\t\t\t\t{% if(j == 0) { %}\n\t\t\t\t\t\t\t{% if(i == 1) { %}\n\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = \\\"x\\\";\n\t\t\t\t\t\t\t{% } else { %}\n\n\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = Math.log(parseInt(\\\"{%= report.columns[i].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))) / Math.LN10;\n\t\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% } else { %}\n\t\t\t\t\t\t\t{% if(i == 1) { %}\n\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = \\\"{%= data[j-1][report.columns[i].field] %} \\\";\n\t\t\t\t\t\t\t{% } else { %}\n\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = {% if(data[j-1][report.columns[i].field] == \"\") { if (i > 2) { %} \n\t\t\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-2] \n\t\t\t\t\t\t\t\t\t{% } else { %} \n\t\t\t\t\t\t\t\t\t\t0 \n\t\t\t\t\t\t\t\t{% } } else { %} \n\t\t\t\t\t\t\t\t\t{%= data[j-1][report.columns[i].field] %} \n\t\t\t\t\t\t\t{% } %};\n\t\t\t\t\t\t\t{% } %};\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t{% } else { %}\n\t\t\t\t\t\t{% if(j == 0) { %}\n\t\t\t\t\t\t\t{% if(i < l-1) { %}\n\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = Math.log(parseInt(\\\"{%= report.columns[i+1].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))-1) / Math.LN10;\n\t\t\t\t\t\t\t{% } else { %}\n\t\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = Math.log(2*parseInt(\\\"{%= report.columns[i-1].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))) / Math.LN10;\n\t\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% } else { %}\n\n\t\t\t\t\t\t\ttempData{%=j%}[{%=i%}-1] = tempData{%=j%}[{%=i%}-2];\n\t\t\t\t\t\t{% } %}\n\n\t\t\t\t\t{% } %}\n\t\t\t\t\t\n\t\t\t\t{% } %}\n\t\t\t\tchartData[{%=j%}] = tempData{%=j%};\n\t\t\t{% } %}\n\t\t\tconsole.log(chartData);\n\t\t\t\n\t\t\thold = {\n\t\t\tbindto: \"#chart_div\" ,data: {\n\t\t\t\tx: \"x\",\n\t\t\t\tcolumns: chartData\n\t\t\t},\n\t\t\taxis: {\n\t\t\t\tx: {\n\t\t\t\t\ttick: {\n\t\t\t\t\t   format: function (x22) { return Math.pow(10,x22).toFixed(0); },\n\t\t\t\t\t\tculling: {\n\t\t\t\t\t\t\tmax: {%=report.columns.length%} / 2\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tpoint: {\n\t\t\t  show: false\n\t\t\t}\n\t\t\t};\n\t\t\tconsole.log(hold);\n\t\t\tvar chart = c3.generate(hold);\n\t\t});\n\t\t\n\t\tfunction onReady(selector, callback) {\n        var intervalID = window.setInterval(function() {\n          if (document.querySelector(selector) !== undefined) {\n            window.clearInterval(intervalID);\n            callback.call(this);\n          }\n        }, 500);}\n\t\t\t\t\n\t\t\n    </script>\n\n </head>\n<div style=\"margin-bottom: 7px;\" class=\"text-center\">\n\t{%= frappe.boot.letter_heads[frappe.defaults.get_default(\"letter_head\")] %}\n</div>\n<h2 class=\"text-center\">{%= __(report.report_name) %}</h2>\n<h4 class=\"text-center\">{%= filters.item %} </h4>\n\n<hr>\n<table class=\"table table-bordered\">\n\t<thead>\n\t\t<tr>\n\t\t\t{% for(var i=0, l=report.columns.length; i<l; i++) { %}\n\t\t\t\t<th style=\"width: 15%\">{%= report.columns[i].label %}</th>\n\t\t\t{% } %}\n\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\n\t\t{% for(var i=0, l=data.length; i<l; i++) { %}\n\t\t\t<tr>\n\t\t\t\n\t\t\t\t{% for(var j=0,m=report.columns.length; j<m; j++) { %}\n\t\t\t\t\t<td style=\"width: 15%\">{%= data[i][report.columns[j].field] %}</td>\n\t\t\t\t{% } %}\n\n\t\t</tr>\n\t\t{% } %}\n\t</tbody>\n</table>\n\n<h4 class=\"text-center\"> Analysis Chart </h4>\n<div id=\"chart_div\"></div>\n\n\n\t\t\n<p class=\"text-right text-muted\">Printed On {%= dateutil.str_to_user(dateutil.get_datetime_as_string()) %}</p>","script":"// Copyright (c) 2016, Frappe Technologies Pvt. Ltd. and contributors\n// For license information, please see license.txt\n\nfrappe.query_reports[\"Quoted Item Comparison\"] = {\n\tfilters: [\n\t\t{\n\t\t\tfieldtype: \"Link\",\n\t\t\tlabel: __(\"Supplier Quotation\"),\n\t\t\toptions: \"Supplier Quotation\",\n\t\t\tfieldname: \"supplier_quotation\",\n\t\t\tdefault: \"\",\n\t\t\tget_query: () => {\n\t\t\t\treturn { filters: { \"docstatus\": [\"<\", 2] } }\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\treqd: 1,\n\t\t\tdefault: \"\",\n\t\t\toptions: \"Item\",\n\t\t\tlabel: __(\"Item\"),\n\t\t\tfieldname: \"item\",\n\t\t\tfieldtype: \"Link\",\n\t\t\tget_query: () => {\n\t\t\t\tlet quote = frappe.query_report_filters_by_name.supplier_quotation.get_value();\n\t\t\t\tif (quote != \"\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"erpnext.stock.doctype.quality_inspection.quality_inspection.item_query\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"from\": \"Supplier Quotation Item\",\n\t\t\t\t\t\t\t\"parent\": quote\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: { \"disabled\": 0 }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t],\n\tonload: (report) => {\n\t\t// Create a button for setting the default supplier\n\t\treport.page.add_inner_button(__(\"Select Default Supplier\"), () => {\n\t\t\tlet reporter = frappe.query_reports[\"Quoted Item Comparison\"];\n\n\t\t\t//Always make a new one so that the latest values get updated\n\t\t\treporter.make_default_supplier_dialog(report);\n\t\t}, 'Tools');\n\n\t},\n\tmake_default_supplier_dialog: (report) => {\n\t\t// Get the name of the item to change\n\t\tif(!report.data) return;\n\n\t\tlet filters = report.get_values();\n\t\tlet item_code = filters.item;\n\n\t\t// Get a list of the suppliers (with a blank as well) for the user to select\n\t\tlet suppliers = $.map(report.data, (row, idx)=>{ return row.supplier_name })\n\n\t\t// Create a dialog window for the user to pick their supplier\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Select Default Supplier'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tlabel: 'Supplier',\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\toptions: 'Supplier',\n\t\t\t\t\tfieldname: 'supplier',\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t'name': ['in', suppliers]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tdialog.set_primary_action(\"Set Default Supplier\", () => {\n\t\t\tlet values = dialog.get_values();\n\t\t\tif(values) {\n\t\t\t\t// Set the default_supplier field of the appropriate Item to the selected supplier\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.set_value\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: item_code,\n\t\t\t\t\t\tfieldname: \"default_supplier\",\n\t\t\t\t\t\tvalue: values.supplier,\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tfrappe.msgprint(\"Successfully Set Supplier\");\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tdialog.show();\n\t}\n}\n\n\n"}}
{"docs":[{"system_page":0,"parent":null,"creation":"2016-03-07 04:46:00.420330","_dynamic_page":1,"module":"Desk","standard":"Yes","doctype":"Page","owner":"Administrator","icon":null,"style":null,"modified_by":"Administrator","name":"modules","roles":[],"script":"frappe.templates[\"modules_section\"] = '<div class=\"module-body\"> {% for (var i=0; i < data.length; i++) { var section = data[i]; %} {% if ((i % 2)===0) { %}<div class=\"row module-section\">{% } %} <div class=\"col-sm-6 module-section-column\"> <div class=\"h4 section-head\"> {{ section.label }} </div> <div class=\"section-body\"> {% for (var j=0; j < section.items.length; j++) { var item = section.items[j]; if(item.shown) { %} <div style=\"min-height: 22px; margin-top: 8px;\"> <a class=\"module-section-link small\" data-type=\"{{ item.type }}\" {% if(item.type===\"help\") { %} data-youtube-id=\"{{ item.youtube_id }}\"{% } %} href=\"#{{ item.route }}\" style=\"{{ item.style }}\"> {{ item.label || __(item.name) }} </a> {% if(item.type===\"doctype\") { %} <span class=\"open-notification global hide\" data-doctype=\"{{ item.doctype || item.name }}\"></span> {% } %} </div> {% } %} {% } %} </div> </div> {% if ((i % 2)===1 || i===data.length-1) { %}</div>{% } %} {% } %} </div> ';\nfrappe.templates[\"modules_sidebar\"] = '<ul class=\"module-sidebar-nav overlay-sidebar nav nav-pills nav-stacked\"> {% for (var i=0, l= modules.length; i < l; i++) { var item = modules[i]; if(item.type===\"module\" && !item.blocked) { %} {{ frappe.render_template(\"modules_sidebar_item\", {\"item\": item}) }} {% }; } %} <li class=\"divider\"></li> </ul>';\nfrappe.templates[\"modules_sidebar_item\"] = ' <li class=\"strong module-sidebar-item\"> <a class=\"module-link\" data-name=\"{{ item.module_name }}\" href=\"#modules/{{ item.module_name }}\"> <i class=\"fa fa-chevron-right pull-right\" style=\"display: none;\"></i> <span>{{ item._label }}</span></a> </li> ';\nfrappe.pages['modules'].on_page_load = function(wrapper) {\n\tvar page = frappe.ui.make_app_page({\n\t\tparent: wrapper,\n\t\ttitle: 'Modules',\n\t\tsingle_column: false\n\t});\n\n\tfrappe.modules_page = page;\n\tfrappe.module_links = {};\n\tpage.section_data = {};\n\n\tpage.wrapper.find('.page-head h1').css({'padding-left': '15px'});\n\t// page.wrapper.find('.page-content').css({'margin-top': '0px'});\n\n\t// menu\n\tpage.add_menu_item(__('Set Desktop Icons'), function() {\n\t\tfrappe.route_options = {\n\t\t\t\"user\": frappe.session.user\n\t\t};\n\t\tfrappe.set_route(\"modules_setup\");\n\t});\n\n\tif(frappe.user.has_role('System Manager')) {\n\t\tpage.add_menu_item(__('Install Apps'), function() {\n\t\t\tfrappe.set_route(\"applications\");\n\t\t});\n\t}\n\n\t// render sidebar\n\tpage.sidebar.html(frappe.render_template('modules_sidebar',\n\t\t{modules: frappe.get_desktop_icons(true).sort(\n\t\t\tfunction(a, b){ return (a._label > b._label) ? 1 : -1 })}));\n\n\t// help click\n\tpage.main.on(\"click\", '.module-section-link[data-type=\"help\"]', function(event) {\n\t\tfrappe.help.show_video($(this).attr(\"data-youtube-id\"));\n\t\treturn false;\n\t});\n\n\t// notifications click\n\tpage.main.on(\"click\", '.open-notification', function(event) {\n\t\tvar doctype = $(this).attr('data-doctype');\n\t\tif(doctype) {\n\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t}\n\t});\n\n\tpage.activate_link = function(link) {\n\t\tpage.last_link = link;\n\t\tpage.wrapper.find('.module-sidebar-item.active, .module-link.active').removeClass('active');\n\t\t$(link).addClass('active').parent().addClass(\"active\");\n\t\tshow_section($(link).attr('data-name'));\n\t}\n\n\tvar show_section = function(module_name) {\n\t\tif(module_name in page.section_data) {\n\t\t\trender_section(page.section_data[module_name]);\n\t\t} else {\n\t\t\tpage.main.empty();\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.desk.moduleview.get\",\n\t\t\t\targs: {\n\t\t\t\t\tmodule: module_name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar m = frappe.get_module(module_name);\n\t\t\t\t\tm.data = r.message.data;\n\t\t\t\t\tprocess_data(module_name, m.data);\n\t\t\t\t\tpage.section_data[module_name] = m;\n\t\t\t\t\trender_section(m);\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t});\n\t\t}\n\n\t}\n\n\tvar render_section = function(m) {\n\t\tpage.set_title(__(m.label));\n\t\tpage.main.html(frappe.render_template('modules_section', m));\n\n\t\t// if(frappe.utils.is_xs() || frappe.utils.is_sm()) {\n\t\t// \t// call this after a timeout, becuase a refresh will set the page to the top\n\t\t// \tsetTimeout(function() {\n\t\t// \t\t$(document).scrollTop($('.module-body').offset().top - 150);\n\t\t// \t}, 100);\n\t\t// }\n\n\t\t//setup_section_toggle();\n\t\tfrappe.app.update_notification_count_in_modules();\n\t}\n\n\tvar process_data = function(module_name, data) {\n\t\tfrappe.module_links[module_name] = [];\n\t\tdata.forEach(function(section) {\n\t\t\tsection.items.forEach(function(item) {\n\t\t\t\titem.style = '';\n\t\t\t\tif(item.type===\"doctype\") {\n\t\t\t\t\titem.doctype = item.name;\n\n\t\t\t\t\t// map of doctypes that belong to a module\n\t\t\t\t\tfrappe.module_links[module_name].push(item.name);\n\t\t\t\t}\n\t\t\t\tif(!item.route) {\n\t\t\t\t\tif(item.link) {\n\t\t\t\t\t\titem.route=strip(item.link, \"#\")\n\t\t\t\t\t}\n\t\t\t\t\telse if(item.type===\"doctype\") {\n\t\t\t\t\t\tif(frappe.model.is_single(item.doctype)) {\n\t\t\t\t\t\t\titem.route = 'Form/' + item.doctype;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (item.filters) {\n\t\t\t\t\t\t\t\tfrappe.route_options=item.filters;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\titem.route=\"List/\" + item.doctype\n\t\t\t\t\t\t\t//item.style = 'font-weight: 500;';\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// item.style = 'font-weight: bold;';\n\t\t\t\t\t}\n\t\t\t\t\telse if(item.type===\"report\" && item.is_query_report) {\n\t\t\t\t\t\titem.route=\"query-report/\" + item.name\n\t\t\t\t\t}\n\t\t\t\t\telse if(item.type===\"report\") {\n\t\t\t\t\t\titem.route=\"Report/\" + item.doctype + \"/\" + item.name\n\t\t\t\t\t}\n\t\t\t\t\telse if(item.type===\"page\") {\n\t\t\t\t\t\titem.route=item.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(item.route_options) {\n\t\t\t\t\titem.route += \"?\" + $.map(item.route_options, function(value, key) {\n\t\t\t\t\t\treturn encodeURIComponent(key) + \"=\" + encodeURIComponent(value) }).join('&')\n\t\t\t\t}\n\n\t\t\t\tif(item.type===\"page\" || item.type===\"help\" || item.type===\"report\" ||\n\t\t\t\t(item.doctype && frappe.model.can_read(item.doctype))) {\n\t\t\t\t\titem.shown = true;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nfrappe.pages['modules'].on_page_show = function(wrapper) {\n\tvar route = frappe.get_route();\n\t$(\"body\").attr(\"data-sidebar\", 1);\n\tif(route.length > 1) {\n\t\t// activate section based on route\n\t\tfrappe.modules_page.activate_link(\n\t\t\tfrappe.modules_page.sidebar.find('.module-link[data-name=\"'+ route[1] +'\"]'));\n\t} else if(frappe.modules_page.last_link) {\n\t\t// open last link\n\t\tfrappe.set_route('modules', frappe.modules_page.last_link.attr('data-name'))\n\t} else {\n\t\t// first time, open the first page\n\t\tfrappe.modules_page.activate_link(frappe.modules_page.sidebar.find('.module-link:first'));\n\t}\n}\n\n","title":"Modules","restrict_to_domain":null,"modified":"2016-03-07 04:46:00.420330","content":null,"idx":0,"parenttype":null,"page_name":"modules","docstatus":0,"parentfield":null}]}
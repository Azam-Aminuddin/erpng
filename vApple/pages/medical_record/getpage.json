{"docs":[{"system_page":0,"parent":null,"creation":"2016-06-09 11:33:14.025787","_dynamic_page":1,"module":"Healthcare","standard":"Yes","doctype":"Page","owner":"Administrator","icon":"icon-play","style":"#page-medical_record .label {\n\tdisplay: inline-block;\n\tmargin-right: 7px;\n}\n\n#page-medical_record .list-row {\n\tborder: none;\n\tpadding: 0px;\n\tcursor: pointer;\n}\n\n.medical_record-label {\n\tmax-width: 100px;\n\tmargin-bottom: -4px;\n}\n\n.date-indicator {\n    background:none;\n    font-size:12px;\n    vertical-align:middle;\n    font-weight:bold;\n    color:#6c7680;\n}\n.date-indicator::after {\n    margin:0 -4px 0 12px;\n    content:'';\n    display:inline-block;\n    height:8px;\n    width:8px;\n    border-radius:8px;\n\tbackground: #d1d8dd;\n}\n\n.date-indicator.blue {\n\tcolor: #5e64ff;\n}\n\n.date-indicator.blue::after {\n\tbackground: #5e64ff;\n}\n\n.medical_record-message {\n\tborder-left: 1px solid #d1d8dd;\n\tpadding: 15px;\n\tpadding-right: 30px;\n}\n\n.medical_record-date {\n\tpadding: 15px;\n\tpadding-right: 0px;\n\tz-index: 1;\n}\n\n#page-medical_record .plot-wrapper {\n\tpadding: 20px 15px;\n\tborder-bottom: 1px solid #d1d8dd;\n\ttext-align: center;\n}\n\n#page-medical_record .plot {\n\theight: 140px ;\n\twidth: 97% ;\n\tmargin: auto;\n}\n\n#page-medical_record .list-filters {\n\tdisplay: none ;\n}\n\n#page-medical_record .octicon-heart {\n\tcolor: #ff5858;\n\tmargin: 0px 5px;\n}\n","modified_by":"Administrator","name":"medical_record","roles":[{"modified_by":"Administrator","name":null,"parent":"medical_record","creation":"2016-06-09 11:33:14.025787","modified":"2017-09-29 01:32:53.068914","doctype":"Has Role","idx":1,"parenttype":"Page","role":"Physician","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"frappe.templates[\"patient_select\"] = '<div class=\"text-center col-sm-9\" style=\"padding: 40px;\"> <p>{%= __(\"Select Patient\") %}</p> <p class=\"patient\" style=\"margin: auto; max-width: 300px; margin-bottom: 20px;\"></p> </div> ';\nfrappe.templates[\"medical_record_row\"] = '<div class=\"row medical_record-row\" data-creation=\"{%= creation.split(\" \")[0] + \" 00:00:00\" %}\"> <div class=\"col-xs-3 text-right medical_record-date\"><span class=\"{%= date_class %}\"> {%= date_sep || \"\" %}</span> </div> <div class=\"col-xs-9 medical_record-message\" data-doctype=\"{%= reference_doctype %}\" data-docname=\"{%= reference_name %}\" title=\"{%= by %} / {%= dateutil.str_to_user(creation) %}\"> <span class=\"avatar avatar-small\"> <div class=\"avatar-frame\" style=\"background-image: url({{ imgsrc }});\"></div>  </span> <span class=\"small\"> {% if (reference_doctype && reference_name) { %} {%= __(\"{0}: {1}\", [link, \"<strong>\" + subject + \"</strong>\"]) %} {% } else { %} {%= subject %} {% } %} </span> </div> </div> ';\nfrappe.provide(\"frappe.medical_record\");\nfrappe.pages['medical_record'].on_page_load = function(wrapper) {\n\tvar me = this;\n\tvar page = frappe.ui.make_app_page({\n\t\tparent: wrapper,\n\t\ttitle: 'Medical Record',\n\t});\n\n\tfrappe.breadcrumbs.add(\"Medical\");\n\n\tpage.main.html(frappe.render_template(\"patient_select\", {}));\n\tvar patient = frappe.ui.form.make_control({\n\t\tparent: page.main.find(\".patient\"),\n\t\tdf: {\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Patient\",\n\t\t\tfieldname: \"patient\",\n\t\t\tchange: function(){\n\t\t\t\tpage.main.find(\".frappe-list\").html(\"\");\n\t\t\t\tdraw_page(patient.get_value(), me);\n\t\t\t}\n\t\t},\n\t\tonly_input: true,\n\t});\n\tpatient.refresh();\n\n\n\tthis.page.main.on(\"click\", \".medical_record-message\", function() {\n\t\tvar\tdoctype = $(this).attr(\"data-doctype\"),\n\t\t\tdocname = $(this).attr(\"data-docname\");\n\n\t\tif (doctype && docname) {\n\t\t\tfrappe.route_options = {\n\t\t\t\tscroll_to: { \"doctype\": doctype, \"name\": docname }\n\t\t\t};\n\t\t\tfrappe.set_route([\"Form\", doctype, docname]);\n\t\t}\n\t});\n\n\tthis.page.sidebar.on(\"click\", \".edit-details\", function() {\n\t\tpatient = patient.get_value();\n\t\tif (patient) {\n\t\t\tfrappe.set_route([\"Form\", \"Patient\", patient]);\n\t\t}\n\t});\n\n};\n\nfrappe.pages['medical_record'].refresh = function() {\n\tvar me = this;\n\n\tif(frappe.route_options) {\n\t\tif(frappe.route_options.patient){\n\t\t\tme.page.main.find(\".frappe-list\").html(\"\");\n\t\t\tvar patient = frappe.route_options.patient;\n\t\t\tdraw_page(patient,me);\n\t\t\tme.page.main.find(\"[data-fieldname='patient']\").val(patient);\n\t\t\tfrappe.route_options = null;\n\t\t}\n\t}\n};\nvar show_patient_info = function(patient, me){\n\tfrappe.call({\n\t\t\"method\": \"erpnext.healthcare.doctype.patient.patient.get_patient_detail\",\n\t\targs: {\n\t\t\tpatient: patient\n\t\t},\n\t\tcallback: function (r) {\n\t\t\tvar data = r.message;\n\t\t\tvar details = \"\";\n\t\t\tif(data.email) details += \"<br><b>Email :</b> \" + data.email;\n\t\t\tif(data.mobile) details += \"<br><b>Mobile :</b> \" + data.mobile;\n\t\t\tif(data.occupation) details += \"<br><b>Occupation :</b> \" + data.occupation;\n\t\t\tif(data.blood_group) details += \"<br><b>Blood group : </b> \" + data.blood_group;\n\t\t\tif(data.allergies) details +=  \"<br><br><b>Allergies : </b> \"+  data.allergies;\n\t\t\tif(data.medication) details +=  \"<br><b>Medication : </b> \"+  data.medication;\n\t\t\tif(data.alcohol_current_use) details +=  \"<br><br><b>Alcohol use : </b> \"+  data.alcohol_current_use;\n\t\t\tif(data.alcohol_past_use) details +=  \"<br><b>Alcohol past use : </b> \"+  data.alcohol_past_use;\n\t\t\tif(data.tobacco_current_use) details +=  \"<br><b>Tobacco use : </b> \"+  data.tobacco_current_use;\n\t\t\tif(data.tobacco_past_use) details +=  \"<br><b>Tobacco past use : </b> \"+  data.tobacco_past_use;\n\t\t\tif(data.medical_history) details +=  \"<br><br><b>Medical history : </b> \"+  data.medical_history;\n\t\t\tif(data.surgical_history) details +=  \"<br><b>Surgical history : </b> \"+  data.surgical_history;\n\t\t\tif(data.surrounding_factors) details +=  \"<br><br><b>Occupational hazards : </b> \"+  data.surrounding_factors;\n\t\t\tif(data.other_risk_factors) details += \"<br><b>Other risk factors : </b> \" + data.other_risk_factors;\n\t\t\tif(data.patient_details) details += \"<br><br><b>More info : </b> \" + data.patient_details;\n\n\t\t\tif(details){\n\t\t\t\tdetails = \"<div style='padding-left:10px; font-size:13px;' align='center'></br><b class='text-muted'>Patient Details</b>\" + details + \"</div>\";\n\t\t\t}\n\n\t\t\tvar vitals = \"\";\n\t\t\tif(data.temperature) vitals += \"<br><b>Temperature :</b> \" + data.temperature;\n\t\t\tif(data.pulse) vitals += \"<br><b>Pulse :</b> \" + data.pulse;\n\t\t\tif(data.respiratory_rate) vitals += \"<br><b>Respiratory Rate :</b> \" + data.respiratory_rate;\n\t\t\tif(data.bp) vitals += \"<br><b>BP :</b> \" + data.bp;\n\t\t\tif(data.bmi) vitals += \"<br><b>BMI :</b> \" + data.bmi;\n\t\t\tif(data.height) vitals += \"<br><b>Height :</b> \" + data.height;\n\t\t\tif(data.weight) vitals += \"<br><b>Weight :</b> \" + data.weight;\n\t\t\tif(data.signs_date) vitals += \"<br><b>Date :</b> \" + data.signs_date;\n\n\t\t\tif(vitals){\n\t\t\t\tvitals = \"<div style='padding-left:10px; font-size:13px;' align='center'></br><b class='text-muted'>Vital Signs</b>\" + vitals + \"<br></div>\";\n\t\t\t\tdetails = vitals + details;\n\t\t\t}\n\t\t\tif(details) details += \"<div align='center'><br><a class='btn btn-default btn-sm edit-details'>Edit Details</a></b> </div>\";\n\n\t\t\tme.page.sidebar.addClass(\"col-sm-3\");\n\t\t\tme.page.sidebar.html(details);\n\t\t\tme.page.wrapper.find(\".layout-main-section-wrapper\").addClass(\"col-sm-9\");\n\t\t}\n\t});\n};\nvar draw_page = function(patient, me){\n\tfrappe.model.with_doctype(\"Patient Medical Record\", function() {\n\t\tme.page.list = new frappe.ui.BaseList({\n\t\t\thide_refresh: true,\n\t\t\tpage: me.page,\n\t\t\tmethod: 'erpnext.healthcare.page.medical_record.medical_record.get_feed',\n\t\t\targs: {name: patient},\n\t\t\tparent: $(\"<div></div>\").appendTo(me.page.main),\n\t\t\trender_view: function(values) {\n\t\t\t\tvar me = this;\n\t\t\t\tvar wrapper = me.page.main.find(\".result-list\").get(0);\n\t\t\t\tvalues.map(function (value) {\n\t\t\t\t\tvar row = $('<div class=\"list-row\">').data(\"data\", value).appendTo($(wrapper)).get(0);\n\t\t\t\t\tnew frappe.medical_record.Feed(row, value);\n\t\t\t\t});\n\t\t\t},\n\t\t\tshow_filters: true,\n\t\t\tdoctype: \"Patient Medical Record\",\n\t\t});\n\t\tshow_patient_info(patient, me);\n\t\tme.page.list.run();\n\t});\n};\n\nfrappe.medical_record.last_feed_date = false;\nfrappe.medical_record.Feed = Class.extend({\n\tinit: function(row, data) {\n\t\tthis.scrub_data(data);\n\t\tthis.add_date_separator(row, data);\n\t\tif(!data.add_class)\n\t\t\tdata.add_class = \"label-default\";\n\n\t\tdata.link = \"\";\n\t\tif (data.reference_doctype && data.reference_name) {\n\t\t\tdata.link = frappe.format(data.reference_name, {fieldtype: \"Link\", options: data.reference_doctype},\n\t\t\t\t{label: __(data.reference_doctype)});\n\t\t}\n\n\t\t$(row)\n\t\t\t.append(frappe.render_template(\"medical_record_row\", data))\n\t\t\t.find(\"a\").addClass(\"grey\");\n\t},\n\tscrub_data: function(data) {\n\t\tdata.by = frappe.user.full_name(data.owner);\n\t\tdata.imgsrc = frappe.utils.get_file_link(frappe.user_info(data.owner).image);\n\n\t\tdata.icon = \"icon-flag\";\n\t},\n\tadd_date_separator: function(row, data) {\n\t\tvar date = frappe.datetime.str_to_obj(data.creation);\n\t\tvar last = frappe.medical_record.last_feed_date;\n\n\t\tif((last && frappe.datetime.obj_to_str(last) != frappe.datetime.obj_to_str(date)) || (!last)) {\n\t\t\tvar diff = frappe.datetime.get_day_diff(frappe.datetime.get_today(), frappe.datetime.obj_to_str(date));\n\t\t\tif(diff < 1) {\n\t\t\t\tvar pdate = 'Today';\n\t\t\t} else if(diff < 2) {\n\t\t\t\tpdate = 'Yesterday';\n\t\t\t} else {\n\t\t\t\tpdate = frappe.datetime.global_date_format(date);\n\t\t\t}\n\t\t\tdata.date_sep = pdate;\n\t\t\tdata.date_class = pdate=='Today' ? \"date-indicator blue\" : \"date-indicator\";\n\t\t} else {\n\t\t\tdata.date_sep = null;\n\t\t\tdata.date_class = \"\";\n\t\t}\n\t\tfrappe.medical_record.last_feed_date = date;\n\t}\n});\n","title":"Medical Record","restrict_to_domain":null,"modified":"2017-03-06 11:20:40.174661","content":null,"idx":0,"parenttype":null,"page_name":"medical_record","docstatus":0,"parentfield":null}]}
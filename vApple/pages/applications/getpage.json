{"docs":[{"system_page":0,"parent":null,"creation":"2013-12-23 11:01:52","_dynamic_page":1,"module":"Desk","standard":"Yes","doctype":"Page","owner":"Administrator","icon":"fa fa-magic","style":".app-listing {\n\tborder-top: 1px solid #d1d8dd;\n}\n\n#page-applications .media-body {\n\tmargin-top: 3px;\n}\n\n#page-applications .app-icon-wrapper {\n\tpadding-right: 15px;\n}\n\n#page-applications .app-buttons .btn {\n\twidth: 64px;\n\ttext-align: center;\n}\n","modified_by":"Administrator","name":"applications","roles":[{"modified_by":"Administrator","name":null,"parent":"applications","creation":"2013-12-23 11:01:52","modified":"2017-06-09 23:47:43.872711","doctype":"Has Role","idx":1,"parenttype":"Page","role":"System Manager","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"frappe.templates[\"application_row\"] = '<div class=\"app-listing padding\" data-category=\"{{ app.app_category || \"Not set\" }}\" data-title=\"{{ app.app_title }}\" {{ app.installed ? \"data-installed=1\" : \"\" }} {{ app.featured ? \"data-featured=1\" : \"\" }}> <div class=\"media\"> <div class=\"pull-right app-buttons\"> <a class=\"btn btn-default btn-xs\" href=\"{{ app.app_url }}\" target=\"_blank\" rel=\"noopener noreferrer\">{{ __(\"Website\") }}</a> {% if (app.installed) { %} <button class=\"btn btn-danger btn-xs btn-remove\" data-title=\"{{ app.app_title }}\" data-app=\"{{ app.app_name }}\" {% if app.app_name === \"erpnext\" || app.app_name === \"frappe\" %}disabled{% endif %}> {{ __(\"Remove\") }}</button> {% } else { %} <button class=\"btn btn-primary btn-xs install\" data-app=\"{{ app.app_name }}\" data-title=\"{{ app.app_title }}\" >{{ __(\"Install\") }}</button> {% } %} </div> <div class=\"pull-left app-icon-wrapper\">{{ app.app_icon }}</div> <div class=\"media-body\"> <h5 class=\"media-heading\">{{ app.app_title }}</h5> <div class=\"text-muted\"> {{ app.app_description }}<br> {{ __(\"Publisher\") }}: {{ app.app_publisher }} | {{ __(\"Version\") }}: {{ app.app_version }} </div> </div> </div> </div> ';\nfrappe.provide(\"frappe.applications\");\n\nfrappe.pages['applications'].on_page_load = function(parent) {\n\tfrappe.applications.installer = new frappe.applications.Installer(parent);\n};\n\nfrappe.applications.Installer = Class.extend({\n\tinit: function(parent) {\n\t\tthis.parent = parent;\n\t\tthis.get_app_list();\n\t\tthis.setup_realtime();\n\t},\n\n\tget_app_list: function() {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.page.applications.applications.get_app_list\",\n\t\t\tcallback: function(r) {\n\t\t\t\tvar apps = r.message;\n\n\t\t\t\tme.make_page();\n\n\t\t\t\t// no apps\n\t\t\t\tif(!Object.keys(apps).length) {\n\t\t\t\t\tme.wrapper.html('<div class=\"text-muted app-listing padding\">' + __(\"No Apps Installed\") + '</div>');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.wrapper.empty();\n\t\t\t\tme.make_toolbar();\n\t\t\t\tme.make_app_list(apps);\n\n\t\t\t\t// startup with \"Featured\"\n\t\t\t\tme.toggle_category();\n\t\t\t\tme.update_no_result();\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_toolbar: function() {\n\t\tvar me = this;\n\t\tthis.category_select = this.page.add_select(__(\"Category\"),\n\t\t\t[\n\t\t\t\t{\"label\": __(\"Select Category...\"), value: \"Featured\" },\n\t\t\t\t{\"label\": __(\"Not set\"), value: \"Not set\" },\n\t\t\t\t{\"label\": __(\"Domains\"), value: \"Domains\" },\n\t\t\t\t{\"label\": __(\"Developer Tools\"), value: \"Developer Tools\" },\n\t\t\t\t{\"label\": __(\"Integrations\"), value: \"Integrations\" },\n\t\t\t\t{\"label\": __(\"Portal\"), value: \"Portal\" },\n\t\t\t\t{\"label\": __(\"Regional Extensions\"), value: \"Regional Extensions\" },\n\t\t\t]);\n\n\t\tthis.category_select.on(\"change\", function() {\n\t\t\tme.search.val(\"\");\n\t\t\tme.toggle_category();\n\t\t\tme.update_no_result();\n\t\t});\n\n\t\tthis.search = this.page.add_data(__(\"Search\"))\n\t\tthis.search.on(\"keyup\", function() {\n\t\t\tme.title.text(__(\"Search Results\"));\n\n\t\t\tvar val = ($(this).val() || \"\").toLowerCase();\n\n\t\t\t// disable other inputs when searching\n\t\t\tme.category_select.val(\"Featured\").prop(\"disabled\", val.length ? true : false);\n\t\t\tme.show_installed.$input.prop(\"disabled\", val.length ? true : false);\n\n\t\t\t// filter items\n\t\t\tme.wrapper.find(\".app-listing\").each(function() {\n\t\t\t\t$(this).toggle($(this).attr(\"data-title\").toLowerCase().indexOf(val)!==-1);\n\t\t\t});\n\n\t\t\tme.update_no_result();\n\t\t});\n\n\t\tthis.show_installed = this.page.add_field({fieldtype:\"Check\", label:__(\"Installed\") });\n\t\tthis.show_installed.$input.on(\"change\", function() {\n\t\t\tme.category_select.val(\"Featured\");\n\t\t\tme.search.val(\"\");\n\t\t\tme.toggle_installed($(this).prop(\"checked\"));\n\n\t\t\t// disable category and search if showing installed\n\t\t\tme.category_select.prop(\"disabled\", $(this).prop(\"checked\"));\n\t\t\tme.search.val(\"\");\n\t\t\tme.search.prop(\"disabled\", $(this).prop(\"checked\"));\n\n\t\t\tme.update_no_result();\n\t\t});\n\n\t},\n\n\ttoggle_installed: function(show) {\n\t\tif(show) {\n\t\t\tthis.title.text(__(\"Installed Apps\"));\n\n\t\t\tthis.wrapper.find(\".app-listing\").each(function() {\n\t\t\t\t$(this).toggle($(this).attr(\"data-installed\")===\"1\");\n\t\t\t});\n\t\t} else {\n\t\t\tthis.toggle_category();\n\t\t}\n\t},\n\n\ttoggle_category: function() {\n\t\tvar me = this;\n\t\tvar val = ($(this.category_select).val() || \"Featured\");\n\n\t\tthis.title.text(__(val));\n\t\tthis.wrapper.find(\".app-listing\").each(function() {\n\t\t\t// if($(this).attr(\"data-installed\")===\"1\") {\n\t\t\t// \tvar toggle = false;\n\t\t\t// } else\n\t\t\tif(val===\"Featured\") {\n\t\t\t\tvar toggle = $(this).attr(\"data-featured\") == \"1\";\n\t\t\t} else {\n\t\t\t\tvar toggle = $(this).attr(\"data-category\") === val;\n\t\t\t}\n\t\t\t$(this).toggle(toggle);\n\t\t});\n\n\t},\n\n\tmake_app_list: function(apps) {\n\t\tvar me = this;\n\t\tvar modules = {};\n\n\t\tme.title = $('<h3 class=\"text-muted\" style=\"padding: 0px 15px; \\\n\t\t\tfont-weight: 400;\"></h3>').text(__(\"Featured\")).appendTo(me.wrapper);\n\n\t\t$.each(Object.keys(apps).sort(), function(i, app_key) {\n\t\t\tvar app = apps[app_key];\n\n\t\t\tmodules[app_key] = {\n\t\t\t\tlabel: app.app_title,\n\t\t\t\ticon: app.app_icon,\n\t\t\t\tcolor: app.app_color,\n\t\t\t\tis_app: true\n\t\t\t};\n\n\t\t\tapp.app_icon = frappe.ui.app_icon.get_html(modules[app_key]);\n\n\t\t\t$(frappe.render_template(\"application_row\", {app: app})).appendTo(me.wrapper);\n\t\t});\n\n\t\tme.no_result = $('<p class=\"text-muted\" style=\"padding: 15px;\">'\n\t\t\t+ __('No matching apps found') + '</p>').appendTo(me.wrapper).toggle(false);\n\n\t\tthis.wrapper.find(\".install\").on(\"click\", function() {\n\t\t\tme.install_app($(this).attr(\"data-app\"), $(this).attr(\"data-title\"), this);\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-remove\").on(\"click\", function() {\n\t\t\tme.remove_app($(this).attr(\"data-app\"), $(this).attr(\"data-title\"), this);\n\t\t});\n\n\t},\n\n\tupdate_no_result: function() {\n\t\tthis.no_result.toggle(this.wrapper.find(\".app-listing:visible\").length ? false : true);\n\t},\n\n\tinstall_app: function(app_name, app_title, btn) {\n\t\tfrappe.confirm(__(\"Install {0}?\", [app_title]), function() {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.page.applications.applications.install_app\",\n\t\t\t\targs: { name: app_name },\n\t\t\t\tfreeze: true,\n\t\t\t\tbtn: btn\n\t\t\t});\n\t\t});\n\t},\n\n\tremove_app: function(app_name, app_title, btn) {\n\t\tfrappe.confirm(__(\"Remove {0} and delete all data?\", [app_title]), function() {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.page.applications.applications.remove_app\",\n\t\t\t\targs: { name: app_name },\n\t\t\t\tfreeze: true,\n\t\t\t\tbtn: btn\n\t\t\t});\n\t\t});\n\t},\n\n\tmake_page: function() {\n\t\tif (this.page)\n\t\t\treturn;\n\n\t\tfrappe.ui.make_app_page({\n\t\t\tparent: this.parent,\n\t\t\ttitle: __('App Installer'),\n\t\t\ticon: \"fa fa-download\",\n\t\t\tsingle_column: true\n\t\t});\n\n\t\tthis.page = this.parent.page;\n\t\tthis.wrapper = $('<div></div>').appendTo(this.page.main);\n\n\t},\n\n\tsetup_realtime: function() {\n\t\tfrappe.realtime.on(\"install_app_progress\", function(data) {\n\t\t\tif(data.status) {\n\t\t\t\tfrappe.update_msgprint(data.status);\n\t\t\t}\n\t\t})\n\t}\n});\n","title":"App Installer","restrict_to_domain":null,"modified":"2015-11-18 06:20:09.586810","content":null,"idx":1,"parenttype":null,"page_name":"applications","docstatus":0,"parentfield":null}]}
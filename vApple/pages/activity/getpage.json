{"docs":[{"system_page":0,"parent":null,"creation":"2013-04-09 11:45:31","_dynamic_page":1,"module":"Desk","standard":"Yes","doctype":"Page","owner":"Administrator","icon":"fa fa-play","style":"#page-activity .label {\n\tdisplay: inline-block;\n\tmargin-right: 7px;\n}\n\n#page-activity .list-row {\n\tborder: none;\n\tpadding: 0px;\n\tcursor: pointer;\n}\n\n.activity-label {\n\tmax-width: 100px;\n\tmargin-bottom: -4px;\n}\n\n.date-indicator {\n    background:none;\n    font-size:12px;\n    vertical-align:middle;\n    font-weight:bold;\n    color:#6c7680;\n}\n.date-indicator::after {\n    margin:0 -4px 0 12px;\n    content:'';\n    display:inline-block;\n    height:8px;\n    width:8px;\n    border-radius:8px;\n\tbackground: #d1d8dd;\n}\n\n.date-indicator.blue {\n\tcolor: #5e64ff;\n}\n\n.date-indicator.blue::after {\n\tbackground: #5e64ff;\n}\n\n.activity-message {\n\tborder-left: 1px solid #d1d8dd;\n\tpadding: 15px;\n\tpadding-right: 30px;\n}\n\n.activity-date {\n\tpadding: 15px;\n\tpadding-right: 0px;\n\tz-index: 1;\n}\n\n#page-activity .list-filters {\n\tdisplay: none !important;\n}\n\n#page-activity .octicon-heart {\n\tcolor: #ff5858;\n\tmargin: 0px 5px;\n}\n\n.heatmap {\n  padding-top: 30px;\n}\n\n.heatmap svg {\n\tmargin: auto;\n}","modified_by":"Administrator","name":"activity","roles":[{"modified_by":"Administrator","name":null,"parent":"activity","creation":"2013-04-09 11:45:31","modified":"2017-06-09 23:47:43.897586","doctype":"Has Role","idx":1,"parenttype":"Page","role":"All","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"frappe.templates[\"activity_row\"] = '<div class=\"row activity-row\" data-creation=\"{%= creation.split(\" \")[0] + \" 00:00:00\" %}\"> <div class=\"col-xs-3 text-right activity-date\"><span class=\"{%= date_class %}\"> {%= date_sep || \"\" %}</span></div> <div class=\"col-xs-9 activity-message\" data-doctype=\"{%= reference_doctype %}\" data-docname=\"{%= reference_name %}\" data-link-doctype=\"{{ link_doctype }}\" data-link-name=\"{{ link_name }}\" title=\"{%= by %} / {%= dateutil.str_to_user(creation) %}\"> {{ avatar }} <span class=\"small\"> {% if (feed_type===\"Login\") { %} {%= __(\"Logged in\") %} {% } else if (feed_type===\"Label\") { %} {%= __(\"{0} {1}\", [\"<strong>\" + subject + \"</strong>\", link]) %} {% } else if (reference_doctype && feed_type===\"Comment\") { %} {%= __(\"Commented on {0}: {1}\", [link, \"<strong>\" + content + \"</strong>\"]) %} {% } else if (reference_doctype && communication_type===\"Communication\") { %} {%= __(\"Communicated via {0} on {1}: {2}\", [__(feed_type), link, \"<strong>\" + subject + \"</strong>\"]) %} {% } else if (reference_doctype && !feed_type) { %} {%= __(\"Updated {0}: {1}\", [link, \"<strong>\" + subject + \"</strong>\"]) %} {% } else if (feed_type===\"Like\" && reference_doctype) { %} {%= by %} <i class=\"octicon octicon-heart\"></i> {% if (in_list([\"Comment\", \"Communication\"], reference_doctype)) { %} {%= content %} {% } else { %} {%= link %} {% } %} {% } else if (in_list([\"Created\", \"Submitted\", \"Cancelled\", \"Deleted\"], feed_type)) { %} {%= __(\"{0} {1}\", [\"<strong>\" + __(feed_type) + \"</strong>\", feed_type===\"Deleted\" ? subject : link ]) %} {% } else if (feed_type===\"Updated\") { %} {%= __(\"Updated {0}: {1}\", [link, \"<strong>\" + subject + \"</strong>\"]) %} {% } else if (feed_type===\"Relinked\") { %} {%= __(\"{0} {1} to {2}\", [by, content,link]) %} {% } else if (reference_doctype && reference_name) { %} {%= __(\"{0}: {1}\", [link, \"<strong>\" + content + \"</strong>\"]) %} {% } else { %} {%= subject %} {% } %} </span> </div> </div> ';\n// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: See license.txt\n\nfrappe.provide(\"frappe.activity\");\n\nfrappe.pages['activity'].on_page_load = function(wrapper) {\n\tvar me = this;\n\n\tfrappe.ui.make_app_page({\n\t\tparent: wrapper,\n\t\tsingle_column: true\n\t});\n\n\tme.page = wrapper.page;\n\tme.page.set_title(__(\"Activity\"));\n\n\tfrappe.model.with_doctype(\"Communication\", function() {\n\t\tme.page.list = new frappe.ui.BaseList({\n\t\t\thide_refresh: true,\n\t\t\tpage: me.page,\n\t\t\tmethod: 'frappe.desk.page.activity.activity.get_feed',\n\t\t\tparent: $(\"<div></div>\").appendTo(me.page.main),\n\t\t\trender_view: function (values) {\n\t\t\t\tvar me = this;\n\t\t\t\twrapper = me.page.main.find(\".result-list\").get(0)\n\t\t\t\tvalues.map(function (value) {\n\t\t\t\t\tvar row = $('<div class=\"list-row\">')\n\t\t\t\t\t\t.data(\"data\", value)\n\t\t\t\t\t\t.appendTo($(wrapper)).get(0);\n\t\t\t\t\tnew frappe.activity.Feed(row, value);\n\t\t\t\t});\n\t\t\t},\n\t\t\tshow_filters: true,\n\t\t\tdoctype: \"Communication\",\n\t\t\tget_args: function() {\n\t\t\t\tif (frappe.route_options && frappe.route_options.show_likes) {\n\t\t\t\t\tdelete frappe.route_options.show_likes;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tshow_likes: true\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn {}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tme.page.list.run();\n\n\t\tme.page.set_primary_action(__(\"Refresh\"), function() {\n\t\t\tme.page.list.filter_list.clear_filters();\n\t\t\tme.page.list.run();\n\t\t}, \"octicon octicon-sync\");\n\t});\n\n\tfrappe.activity.render_heatmap(me.page);\n\n\tme.page.main.on(\"click\", \".activity-message\", function() {\n\t\tvar link_doctype = $(this).attr(\"data-link-doctype\"),\n\t\t\tlink_name = $(this).attr(\"data-link-name\"),\n\t\t\tdoctype = $(this).attr(\"data-doctype\"),\n\t\t\tdocname = $(this).attr(\"data-docname\");\n\n\t\tif (doctype && docname) {\n\t\t\tif (link_doctype && link_name) {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tscroll_to: { \"doctype\": doctype, \"name\": docname }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.set_route([\"Form\", link_doctype || doctype, link_name || docname]);\n\t\t}\n\t});\n\n\t// Build Report Button\n\tif(frappe.boot.user.can_get_report.indexOf(\"Feed\")!=-1) {\n\t\tthis.page.add_menu_item(__('Build Report'), function() {\n\t\t\tfrappe.set_route('Report', \"Feed\");\n\t\t}, 'fa fa-th')\n\t}\n\n\tthis.page.add_menu_item(__('Authentication Log'), function() {\n\t\tfrappe.route_options = {\n\t\t\t\"user\": frappe.session.user\n\t\t}\n\n\t\tfrappe.set_route('Report', \"Authentication Log\");\n\t}, 'fa fa-th')\n\n\tthis.page.add_menu_item(__('Show Likes'), function() {\n\t\tfrappe.route_options = {\n\t\t\tshow_likes: true\n\t\t};\n\t\tme.page.list.run();\n\t}, 'octicon octicon-heart');\n};\n\nfrappe.pages['activity'].on_page_show = function() {\n\tfrappe.breadcrumbs.add(\"Desk\");\n}\n\nfrappe.activity.last_feed_date = false;\nfrappe.activity.Feed = Class.extend({\n\tinit: function(row, data) {\n\t\tthis.scrub_data(data);\n\t\tthis.add_date_separator(row, data);\n\t\tif(!data.add_class)\n\t\t\tdata.add_class = \"label-default\";\n\n\t\tdata.link = \"\";\n\t\tif (data.link_doctype && data.link_name) {\n\t\t\tdata.link = frappe.format(data.link_name, {fieldtype: \"Link\", options: data.link_doctype},\n\t\t\t\t{label: __(data.link_doctype) + \" \" + __(data.link_name)});\n\n\t\t} else if (data.feed_type===\"Comment\" && data.comment_type===\"Comment\") {\n\t\t\t// hack for backward compatiblity\n\t\t\tdata.link_doctype = data.reference_doctype;\n\t\t\tdata.link_name = data.reference_name;\n\t\t\tdata.reference_doctype = \"Communication\";\n\t\t\tdata.reference_name = data.name;\n\n\t\t\tdata.link = frappe.format(data.link_name, {fieldtype: \"Link\", options: data.link_doctype},\n\t\t\t\t{label: __(data.link_doctype) + \" \" + __(data.link_name)});\n\n\t\t} else if (data.reference_doctype && data.reference_name) {\n\t\t\tdata.link = frappe.format(data.reference_name, {fieldtype: \"Link\", options: data.reference_doctype},\n\t\t\t\t{label: __(data.reference_doctype) + \" \" + __(data.reference_name)});\n\t\t}\n\n\t\t$(row)\n\t\t\t.append(frappe.render_template(\"activity_row\", data))\n\t\t\t.find(\"a\").addClass(\"grey\");\n\t},\n\tscrub_data: function(data) {\n\t\tdata.by = frappe.user.full_name(data.owner);\n\t\tdata.avatar = frappe.avatar(data.owner);\n\n\t\tdata.icon = \"fa fa-flag\";\n\n\t\t// color for comment\n\t\tdata.add_class = {\n\t\t\t\"Comment\": \"label-danger\",\n\t\t\t\"Assignment\": \"label-warning\",\n\t\t\t\"Login\": \"label-default\"\n\t\t}[data.comment_type || data.communication_medium] || \"label-info\"\n\n\t\tdata.when = comment_when(data.creation);\n\t\tdata.feed_type = data.comment_type || data.communication_medium;\n\t},\n\tadd_date_separator: function(row, data) {\n\t\tvar date = frappe.datetime.str_to_obj(data.creation);\n\t\tvar last = frappe.activity.last_feed_date;\n\n\t\tif((last && frappe.datetime.obj_to_str(last) != frappe.datetime.obj_to_str(date)) || (!last)) {\n\t\t\tvar diff = frappe.datetime.get_day_diff(frappe.datetime.get_today(), frappe.datetime.obj_to_str(date));\n\t\t\tvar pdate;\n\t\t\tif(diff < 1) {\n\t\t\t\tpdate = 'Today';\n\t\t\t} else if(diff < 2) {\n\t\t\t\tpdate = 'Yesterday';\n\t\t\t} else {\n\t\t\t\tpdate = frappe.datetime.global_date_format(date);\n\t\t\t}\n\t\t\tdata.date_sep = pdate;\n\t\t\tdata.date_class = pdate=='Today' ? \"date-indicator blue\" : \"date-indicator\";\n\t\t} else {\n\t\t\tdata.date_sep = null;\n\t\t\tdata.date_class = \"\";\n\t\t}\n\t\tfrappe.activity.last_feed_date = date;\n\t}\n});\n\nfrappe.activity.render_heatmap = function(page) {\n\tvar me = this;\n\t$('<div class=\"heatmap-container\" style=\"text-align:center\">\\\n\t\t<div class=\"heatmap\" style=\"display:inline-block;\"></div></div>\\\n\t\t<hr style=\"margin-bottom: 0px;\">').prependTo(page.main);\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.page.activity.activity.get_heatmap_data\",\n\t\tcallback: function(r) {\n\t\t\tif(r.message) {\n\t\t\t\tvar heatmap = new frappe.ui.HeatMap({\n\t\t\t\t\tparent: $(\".heatmap\"),\n\t\t\t\t\theight: 100,\n\t\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\t\tcount_label: \"actions\",\n\t\t\t\t\tdiscrete_domains: 0\n\t\t\t\t});\n\n\t\t\t\theatmap.update(r.message);\n\t\t\t}\n\t\t}\n\t})\n}","title":"Activity","restrict_to_domain":null,"modified":"2013-07-11 14:40:20.000001","content":null,"idx":1,"parenttype":null,"page_name":"activity","docstatus":0,"parentfield":null}]}
{"docs":[{"system_page":0,"parent":null,"creation":"2016-08-18 16:44:14.322642","_dynamic_page":1,"module":"Core","standard":"Yes","doctype":"Page","owner":"Administrator","icon":null,"style":null,"modified_by":"Administrator","name":"background_jobs","roles":[{"modified_by":"Administrator","name":null,"parent":"background_jobs","creation":"2016-08-18 16:44:14.322642","modified":"2017-06-09 23:47:39.225210","doctype":"Has Role","idx":1,"parenttype":"Page","role":"System Manager","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"frappe.templates[\"background_jobs\"] = '<div class=\"list-jobs\"> {% if jobs.length %} <table class=\"table table-bordered\" style=\"table-layout: fixed;\"> <thead> <tr> <th style=\"width: 20%\">Queue / Worker</th> <th>Job</th> <th style=\"width: 15%\">Created</th> </tr> </thead> <tbody> {% for j in jobs %} <tr> <td><span class=\"indicator {{ j.color }}\" title=\"{{ j.status }}\">{{ j.queue.split(\".\").slice(-1)[0] }}</span></td> <td style=\"overflow: auto;\"> <div> {{ frappe.utils.encode_tags(j.job_name) }} </div> {% if j.exc_info %} <div> <pre>{{ frappe.utils.encode_tags(j.exc_info) }}</pre> </div> {% endif %} </td> <td class=\"small\">{{ j.creation }}</td> </tr> {% endfor %} </tbody> </table> <p> <span class=\"indicator blue\" style=\"margin-right: 20px;\">Started</span> <span class=\"indicator orange\" style=\"margin-right: 20px;\">Queued</span> <span class=\"indicator red\" style=\"margin-right: 20px;\">Failed</span> <span class=\"indicator green\">Finished</span> </p> {% else %} <p class=\"text-muted\">No pending or current jobs for this site</p> {% endif %} <p class=\"text-muted\" style=\"margin-top: 30px;\">Last refreshed {{ frappe.datetime.now_datetime() }}</p> </div>';\nfrappe.templates[\"background_jobs_outer\"] = '<div style=\"padding: 20px;\"> <p> <div class=\"checkbox\"> <label> <input type=\"checkbox\" class=\"show-failed\"> {{ __(\"Show failed jobs\") }} </label> </div> </p> <div class=\"table-area\"> </div> </div>';\nfrappe.pages['background_jobs'].on_page_load = function(wrapper) {\n\tvar page = frappe.ui.make_app_page({\n\t\tparent: wrapper,\n\t\ttitle: 'Background Jobs',\n\t\tsingle_column: true\n\t});\n\n\t$(frappe.render_template('background_jobs_outer')).appendTo(page.body);\n\tpage.content = $(page.body).find('.table-area');\n\n\tfrappe.pages.background_jobs.page = page;\n}\n\nfrappe.pages['background_jobs'].on_page_show = function(wrapper) {\n\tfrappe.pages.background_jobs.refresh_jobs();\n}\n\nfrappe.pages.background_jobs.refresh_jobs = function() {\n\tvar page = frappe.pages.background_jobs.page;\n\n\t// don't call if already waiting for a response\n\tif(page.called) return;\n\tpage.called = true;\n\tfrappe.call({\n\t\tmethod: 'frappe.core.page.background_jobs.background_jobs.get_info',\n\t\targs: {\n\t\t\tshow_failed: page.body.find('.show-failed').prop('checked') ? 1 : 0\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tpage.called = false;\n\t\t\tpage.body.find('.list-jobs').remove();\n\t\t\t$(frappe.render_template('background_jobs', {jobs:r.message || []})).appendTo(page.content);\n\n\t\t\tif(frappe.get_route()[0]==='background_jobs') {\n\t\t\t\tfrappe.background_jobs_timeout = setTimeout(frappe.pages.background_jobs.refresh_jobs, 2000);\n\t\t\t}\n\t\t}\n\t});\n}\n","title":"Background Jobs","restrict_to_domain":null,"modified":"2016-08-18 16:48:11.577611","content":null,"idx":0,"parenttype":null,"page_name":"background_jobs","docstatus":0,"parentfield":null}]}
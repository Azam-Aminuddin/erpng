{"docs":[{"system_page":0,"parent":null,"creation":"2013-02-14 17:37:37","_dynamic_page":1,"module":"Core","standard":"Yes","doctype":"Page","owner":"Administrator","icon":"fa fa-th","style":null,"modified_by":"Administrator","name":"desktop","roles":[{"modified_by":"Administrator","name":null,"parent":"desktop","creation":"2013-02-14 17:37:37","modified":"2017-06-09 23:47:39.193882","doctype":"Has Role","idx":1,"parenttype":"Page","role":"All","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"frappe.templates[\"desktop_icon_grid\"] = '<div style=\"text-align: center; padding-top: calc(40px + 3%)\"> <div id=\"icon-grid\"> {% for (var i=0, l=desktop_items.length; i < l; i++) { %} {{ frappe.render_template(\"desktop_module_icon\", desktop_items[i]) }} {% } %} </div> <div class=\"help-message-wrapper hidden\"> <div class=\"help-message-container\"> <a class=\"close pull-right\" style=\"margin-right: -7px;\"> <i class=\"octicon octicon-x\"></i></a> <div class=\"help-messages\"> </div> <a class=\"left-arrow octicon octicon-chevron-left\"> </a> <a class=\"right-arrow octicon octicon-chevron-right\"> </a> </div> </div> </div> <div style=\"clear: both\"></div> ';\nfrappe.templates[\"desktop_help_message\"] = '<div><span class=\"indicator blue\">{{ title }}</span></div> <p>{{ description }}</p> <div> <a class=\"btn btn-sm btn-default\" href=\"#{{ route }}\">{{ action }}</a> <span class=\"help-progress\" title=\"{{ __(\"You have made {0} of {1}\", [count, target]) }}\"> <span class=\"help-progress-bar\" style=\"width: {{ Math.floor(count/target*100) }}%\"></span> </span> </div>';\nfrappe.templates[\"desktop_module_icon\"] = '<div class=\"case-wrapper\" data-name=\"{{ module_name }}\" data-link=\"{{ link }}\" title=\"{{ _label }}\"> {{ app_icon }} <div class=\"case-label ellipsis\"> <div class=\"circle module-count-{{ _id }}\" data-doctype=\"{{ _doctype }}\" style=\"display: none;\"> <span class=\"circle-text\"></span> </div>  <span class=\"case-label-text\">{{ _label }}</span> </div> </div> ';\nfrappe.templates[\"all_applications_dialog\"] = '<div><input class=\"form-control desktop-app-search\" type=\"text\" placeholder=\"{%= __(\"Search Application\") %}\"> </div> {% if (frappe.user.has_role(\"System Manager\")) { %} <p class=\"text-right\"><a href=\"#applications\" class=\"btn btn-sm btn-default\">Install new applications</a> </p> {% } %} <hr> <p class=\"text-muted small\">{%= __(\"Checked items will be shown on desktop\") %}</p> <div class=\"list-group all-applications-list\"> {% for(var i=0, l=all_modules.length; i < l; i++) { var module_name = all_modules[i]; var module = frappe.get_module(module_name); if (desktop_items.indexOf(module_name)===-1 || frappe.user.is_module_blocked(module_name)) { continue; } %} <div class=\"list-group-item\" data-label=\"{%= module.label %}\" data-name=\"{%= module.name %}\"> <div class=\"checkbox\"> <label> <input type=\"checkbox\" {% if (user_desktop_items.indexOf(module.name)!==-1) { %} checked {% } %} data-name=\"{%= module.name %}\" {{ module.force_show ? \"disabled\" : \"\"}}> {%= __(module.label) %} </label> </div> </div> {% } %} </div> ';\nfrappe.templates[\"desktop_list_view\"] = '<div class=\"container page-body\"> <div class=\"row\"> <div class=\"layout-main-section\"> <div class=\"page-content desktop-list\" style=\"margin-top: 40px;\"> {% for (var i=0, l=desktop_items.length; i < l; i++) { var module = desktop_items[i]; %} <div class=\"desktop-list-item\" id=\"module-icon-{%= module._id %}\" data-name=\"{%= module.name %}\" data-link=\"{%= module.link %}\" title=\"{%= module._label %}\"> <h4> <i class=\"{{ module.icon }} text-muted\" style=\"font-size: 20px; margin-right: 15px;\"></i> {{ module._label }} </h4> <span class=\"open-notification global module-count-{{ module._id }}\" style=\"display: none;\"></span> </div> {% } %} </div> </div> </div> </div> ';\nfrappe.provide('frappe.desktop');\n\nfrappe.pages['desktop'].on_page_load = function(wrapper) {\n\n\t// load desktop\n\tif(!frappe.list_desktop) {\n\t\tfrappe.desktop.set_background();\n\t}\n\tfrappe.desktop.refresh(wrapper);\n};\n\nfrappe.pages['desktop'].on_page_show = function(wrapper) {\n\tif(frappe.list_desktop) {\n\t\t$(\"body\").attr(\"data-route\", \"list-desktop\");\n\t}\n};\n\n$.extend(frappe.desktop, {\n\trefresh: function(wrapper) {\n\t\tif (wrapper) {\n\t\t\tthis.wrapper = $(wrapper);\n\t\t}\n\n\t\tthis.render();\n\t\tthis.make_sortable();\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\t\tfrappe.utils.set_title(__(\"Desktop\"));\n\n\t\tvar template = frappe.list_desktop ? \"desktop_list_view\" : \"desktop_icon_grid\";\n\n\t\tvar all_icons = frappe.get_desktop_icons();\n\t\tvar explore_icon = {\n\t\t\tmodule_name: 'Explore',\n\t\t\tlabel: 'Explore',\n\t\t\t_label: __('Explore'),\n\t\t\t_id: 'Explore',\n\t\t\t_doctype: '',\n\t\t\ticon: 'octicon octicon-telescope',\n\t\t\tcolor: '#7578f6',\n\t\t\tlink: 'modules'\n\t\t};\n\t\texplore_icon.app_icon = frappe.ui.app_icon.get_html(explore_icon);\n\t\tall_icons.push(explore_icon);\n\n\t\tfrappe.desktop.wrapper.html(frappe.render_template(template, {\n\t\t\t// all visible icons\n\t\t\tdesktop_items: all_icons,\n\t\t}));\n\n\t\tfrappe.desktop.setup_module_click();\n\n\t\t// notifications\n\t\tfrappe.desktop.show_pending_notifications();\n\t\t$(document).on(\"notification-update\", function() {\n\t\t\tme.show_pending_notifications();\n\t\t});\n\n\t\t$(document).trigger(\"desktop-render\");\n\n\t},\n\n\trender_help_messages: function(help_messages) {\n\t\tvar wrapper = frappe.desktop.wrapper.find('.help-message-wrapper');\n\t\tvar $help_messages = wrapper.find('.help-messages');\n\n\t\tvar set_current_message = function(idx) {\n\t\t\tidx = cint(idx);\n\t\t\twrapper.current_message_idx = idx;\n\t\t\twrapper.find('.left-arrow, .right-arrow').addClass('disabled');\n\t\t\twrapper.find('.help-message-item').addClass('hidden');\n\t\t\twrapper.find('[data-message-idx=\"'+idx+'\"]').removeClass('hidden');\n\t\t\tif(idx > 0) {\n\t\t\t\twrapper.find('.left-arrow').removeClass('disabled');\n\t\t\t}\n\t\t\tif(idx < help_messages.length - 1) {\n\t\t\t\twrapper.find('.right-arrow').removeClass('disabled');\n\t\t\t}\n\t\t}\n\n\t\tif(help_messages) {\n\t\t\twrapper.removeClass('hidden');\n\t\t\thelp_messages.forEach(function(message, i) {\n\t\t\t\tvar $message = $('<div class=\"help-message-item hidden\"></div>')\n\t\t\t\t\t.attr('data-message-idx', i)\n\t\t\t\t\t.html(frappe.render_template('desktop_help_message', message))\n\t\t\t\t\t.appendTo($help_messages);\n\n\t\t\t});\n\n\t\t\tset_current_message(0);\n\n\t\t\twrapper.find('.close').on('click', function() {\n\t\t\t\twrapper.addClass('hidden');\n\t\t\t});\n\t\t}\n\n\t\twrapper.find('.left-arrow').on('click', function() {\n\t\t\tif(wrapper.current_message_idx) {\n\t\t\t\tset_current_message(wrapper.current_message_idx - 1);\n\t\t\t}\n\t\t})\n\n\t\twrapper.find('.right-arrow').on('click', function() {\n\t\t\tif(help_messages.length > wrapper.current_message_idx + 1) {\n\t\t\t\tset_current_message(wrapper.current_message_idx + 1);\n\t\t\t}\n\t\t});\n\n\t},\n\n\tsetup_module_click: function() {\n\t\tif(frappe.list_desktop) {\n\t\t\tfrappe.desktop.wrapper.on(\"click\", \".desktop-list-item\", function() {\n\t\t\t\tfrappe.desktop.open_module($(this));\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.desktop.wrapper.on(\"click\", \".app-icon\", function() {\n\t\t\t\tfrappe.desktop.open_module($(this).parent());\n\t\t\t});\n\t\t}\n\t\tfrappe.desktop.wrapper.on(\"click\", \".circle\", function() {\n\t\t\tvar doctype = $(this).attr('data-doctype');\n\t\t\tif(doctype) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t});\n\t},\n\n\topen_module: function(parent) {\n\t\tvar link = parent.attr(\"data-link\");\n\t\tif(link) {\n\t\t\tif(link.indexOf('javascript:')===0) {\n\t\t\t\teval(link.substr(11));\n\t\t\t} else if(link.substr(0, 1)===\"/\" || link.substr(0, 4)===\"http\") {\n\t\t\t\twindow.open(link, \"_blank\");\n\t\t\t} else {\n\t\t\t\tfrappe.set_route(link);\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\tvar module = frappe.get_module(parent.attr(\"data-name\"));\n\t\t\tif (module && module.onclick) {\n\t\t\t\tmodule.onclick();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t},\n\n\tmake_sortable: function() {\n\t\tif (frappe.dom.is_touchscreen() || frappe.list_desktop) {\n\t\t\treturn;\n\t\t}\n\n\t\tnew Sortable($(\"#icon-grid\").get(0), {\n\t\t\tonUpdate: function(event) {\n\t\t\t\tvar new_order = [];\n\t\t\t\t$(\"#icon-grid .case-wrapper\").each(function(i, e) {\n\t\t\t\t\tnew_order.push($(this).attr(\"data-name\"));\n\t\t\t\t});\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.desktop_icon.desktop_icon.set_order',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'new_order': new_order,\n\t\t\t\t\t\t'user': frappe.session.user\n\t\t\t\t\t},\n\t\t\t\t\tquiet: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tset_background: function() {\n\t\tfrappe.ui.set_user_background(frappe.boot.user.background_image, null,\n\t\t\tfrappe.boot.user.background_style);\n\t},\n\n\tshow_pending_notifications: function() {\n\t\tvar modules_list = frappe.get_desktop_icons();\n\t\tfor (var i=0, l=modules_list.length; i < l; i++) {\n\t\t\tvar module = modules_list[i];\n\n\t\t\tvar module_doctypes = frappe.boot.notification_info.module_doctypes[module.module_name];\n\n\t\t\tvar sum = 0;\n\t\t\tif(module_doctypes) {\n\t\t\t\tif(frappe.boot.notification_info.open_count_doctype) {\n\t\t\t\t\t// sum all doctypes for a module\n\t\t\t\t\tfor (var j=0, k=module_doctypes.length; j < k; j++) {\n\t\t\t\t\t\tvar doctype = module_doctypes[j];\n\t\t\t\t\t\tsum += (frappe.boot.notification_info.open_count_doctype[doctype] || 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(frappe.boot.notification_info.open_count_doctype\n\t\t\t\t&& frappe.boot.notification_info.open_count_doctype[module.module_name]!=null) {\n\t\t\t\t// notification count explicitly for doctype\n\t\t\t\tsum = frappe.boot.notification_info.open_count_doctype[module.module_name];\n\n\t\t\t} else if(frappe.boot.notification_info.open_count_module\n\t\t\t\t&& frappe.boot.notification_info.open_count_module[module.module_name]!=null) {\n\t\t\t\t// notification count explicitly for module\n\t\t\t\tsum = frappe.boot.notification_info.open_count_module[module.module_name];\n\t\t\t}\n\n\t\t\t// if module found\n\t\t\tif(module._id.indexOf('/')===-1) {\n\t\t\t\tvar notifier = $(\".module-count-\" + module._id);\n\t\t\t\tif(notifier.length) {\n\t\t\t\t\tnotifier.toggle(sum ? true : false);\n\t\t\t\t\tvar circle = notifier.find(\".circle-text\");\n\t\t\t\t\tvar text = sum || '';\n\t\t\t\t\tif(text > 99) {\n\t\t\t\t\t\ttext = '99+';\n\t\t\t\t\t}\n\n\t\t\t\t\tif(circle.length) {\n\t\t\t\t\t\tcircle.html(text);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnotifier.html(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","title":"Desktop","restrict_to_domain":null,"modified":"2013-07-11 14:41:56","content":null,"idx":1,"parenttype":null,"page_name":"desktop","docstatus":0,"parentfield":null}]}
{"docs":[{"system_page":0,"parent":null,"creation":"2013-01-04 15:31:45","module":"Support","standard":"Yes","doctype":"Page","owner":"Administrator","icon":"fa fa-bar-chart","style":null,"modified_by":"Administrator","name":"support-analytics","roles":[{"modified_by":"Administrator","name":null,"parent":"support-analytics","creation":"2013-01-04 15:31:45","modified":"2017-06-09 23:52:09.065868","doctype":"Has Role","idx":1,"parenttype":"Page","role":"Support Team","owner":"Administrator","docstatus":0,"parentfield":"roles"}],"script":"// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.pages['support-analytics'].on_page_load = function(wrapper) {\n\tfrappe.ui.make_app_page({\n\t\tparent: wrapper,\n\t\ttitle: __('Support Analytics'),\n\t\tsingle_column: true\n\t});\n\n\tnew erpnext.SupportAnalytics(wrapper);\n\n\n\tfrappe.breadcrumbs.add(\"Support\")\n\n}\n\nerpnext.SupportAnalytics = frappe.views.GridReportWithPlot.extend({\n\tinit: function(wrapper) {\n\t\tthis._super({\n\t\t\ttitle: __(\"Support Analtyics\"),\n\t\t\tparent: $(wrapper).find('.layout-main'),\n\t\t\tpage: wrapper.page,\n\t\t\tdoctypes: [\"Issue\", \"Fiscal Year\"],\n\t\t});\n\t},\n\n\tfilters: [\n\t\t{fieldname: \"fiscal_year\", fieldtype:\"Select\", label: __(\"Fiscal Year\"), link:\"Fiscal Year\",\n\t\t\tdefault_value: __(\"Select Fiscal Year\") + \"...\"},\n\t\t{fieldname: \"from_date\", fieldtype:\"Date\", label: __(\"From Date\")},\n\t\t{fieldname: \"to_date\", fieldtype:\"Date\", label: __(\"To Date\")},\n\t\t{fieldname: \"range\", fieldtype:\"Select\", label: __(\"Range\"),\n\t\t\toptions:[\"Daily\", \"Weekly\", \"Monthly\", \"Quarterly\", \"Yearly\"], default_value: \"Monthly\"}\n\t],\n\t\n\tinit_filter_values: function() {\n\t\tthis._super();\n\t\tthis.filter_inputs.range.val('Monthly');\n\t},\n\n\tsetup_columns: function() {\n\t\tvar std_columns = [\n\t\t\t{id: \"_check\", name: __(\"Plot\"), field: \"_check\", width: 30,\n\t\t\t\tformatter: this.check_formatter},\n\t\t\t{id: \"name\", name: __(\"Status\"), field: \"name\", width: 100},\n\t\t];\n\t\tthis.make_date_range_columns();\n\t\tthis.columns = std_columns.concat(this.columns);\n\t},\n\n\tprepare_data: function() {\n\t\t// add Opening, Closing, Totals rows\n\t\t// if filtered by account and / or voucher\n\t\tvar me = this;\n\t\tvar total_tickets = {name:\"All Tickets\", \"id\": \"all-tickets\",\n\t\t\tchecked:true};\n\t\tvar days_to_close = {name:\"Days to Close\", \"id\":\"days-to-close\",\n\t\t\tchecked:false};\n\t\tvar total_closed = {};\n\t\tvar hours_to_close = {name:\"Hours to Close\", \"id\":\"hours-to-close\",\n\t\t\tchecked:false};\n\t\tvar hours_to_respond = {name:\"Hours to Respond\", \"id\":\"hours-to-respond\",\n\t\t\tchecked:false};\n\t\tvar total_responded = {};\n\n\n\t\t$.each(frappe.report_dump.data[\"Issue\"], function(i, d) {\n\t\t\tvar dateobj = frappe.datetime.str_to_obj(d.creation);\n\t\t\tvar date = d.creation.split(\" \")[0];\n\t\t\tvar col = me.column_map[date];\n\t\t\tif(col) {\n\t\t\t\ttotal_tickets[col.field] = flt(total_tickets[col.field]) + 1;\n\t\t\t\tif(d.status==\"Closed\") {\n\t\t\t\t\t// just count\n\t\t\t\t\ttotal_closed[col.field] = flt(total_closed[col.field]) + 1;\n\n\t\t\t\t\tdays_to_close[col.field] = flt(days_to_close[col.field])\n\t\t\t\t\t\t+ frappe.datetime.get_diff(d.resolution_date, d.creation);\n\n\t\t\t\t\thours_to_close[col.field] = flt(hours_to_close[col.field])\n\t\t\t\t\t\t+ frappe.datetime.get_hour_diff(d.resolution_date, d.creation);\n\n\t\t\t\t}\n\t\t\t\tif (d.first_responded_on) {\n\t\t\t\t\ttotal_responded[col.field] = flt(total_responded[col.field]) + 1;\n\n\t\t\t\t\thours_to_respond[col.field] = flt(hours_to_respond[col.field])\n\t\t\t\t\t\t+ frappe.datetime.get_hour_diff(d.first_responded_on, d.creation);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// make averages\n\t\t$.each(this.columns, function(i, col) {\n\t\t\tif(col.formatter==me.currency_formatter && total_tickets[col.field]) {\n\t\t\t\tdays_to_close[col.field] = flt(days_to_close[col.field]) /\n\t\t\t\t\tflt(total_closed[col.field]);\n\t\t\t\thours_to_close[col.field] = flt(hours_to_close[col.field]) /\n\t\t\t\t\tflt(total_closed[col.field]);\n\t\t\t\thours_to_respond[col.field] = flt(hours_to_respond[col.field]) /\n\t\t\t\t\tflt(total_responded[col.field]);\n\t\t\t}\n\t\t})\n\n\t\tthis.data = [total_tickets, days_to_close, hours_to_close, hours_to_respond];\n\t}\n});\n","title":"Support Analytics","restrict_to_domain":null,"modified":"2013-07-11 14:44:24","content":null,"idx":1,"parenttype":null,"page_name":"support-analytics","docstatus":0,"parentfield":null}]}
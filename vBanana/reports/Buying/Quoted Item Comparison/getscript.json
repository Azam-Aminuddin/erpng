{"message":{"script":"// Copyright (c) 2016, Frappe Technologies Pvt. Ltd. and contributors\r\n// For license information, please see license.txt\r\n\r\nfrappe.query_reports[\"Quoted Item Comparison\"] \u003d {\r\n\tfilters: [\r\n\t\t{\r\n\t\t\tfieldtype: \"Link\",\r\n\t\t\tlabel: __(\"Supplier Quotation\"),\r\n\t\t\toptions: \"Supplier Quotation\",\r\n\t\t\tfieldname: \"supplier_quotation\",\r\n\t\t\tdefault: \"\",\r\n\t\t\tget_query: () \u003d\u003e {\r\n\t\t\t\treturn { filters: { \"docstatus\": [\"\u003c\", 2] } }\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\treqd: 1,\r\n\t\t\tdefault: \"\",\r\n\t\t\toptions: \"Item\",\r\n\t\t\tlabel: __(\"Item\"),\r\n\t\t\tfieldname: \"item\",\r\n\t\t\tfieldtype: \"Link\",\r\n\t\t\tget_query: () \u003d\u003e {\r\n\t\t\t\tlet quote \u003d frappe.query_report_filters_by_name.supplier_quotation.get_value();\r\n\t\t\t\tif (quote !\u003d \"\") {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tquery: \"erpnext.stock.doctype.quality_inspection.quality_inspection.item_query\",\r\n\t\t\t\t\t\tfilters: {\r\n\t\t\t\t\t\t\t\"from\": \"Supplier Quotation Item\",\r\n\t\t\t\t\t\t\t\"parent\": quote\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tfilters: { \"disabled\": 0 }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tonload: (report) \u003d\u003e {\r\n\t\t// Create a button for setting the default supplier\r\n\t\treport.page.add_inner_button(__(\"Select Default Supplier\"), () \u003d\u003e {\r\n\t\t\tlet reporter \u003d frappe.query_reports[\"Quoted Item Comparison\"];\r\n\r\n\t\t\t//Always make a new one so that the latest values get updated\r\n\t\t\treporter.make_default_supplier_dialog(report);\r\n\t\t}, \u0027Tools\u0027);\r\n\r\n\t},\r\n\tmake_default_supplier_dialog: (report) \u003d\u003e {\r\n\t\t// Get the name of the item to change\r\n\t\tif(!report.data) return;\r\n\r\n\t\tlet filters \u003d report.get_values();\r\n\t\tlet item_code \u003d filters.item;\r\n\r\n\t\t// Get a list of the suppliers (with a blank as well) for the user to select\r\n\t\tlet suppliers \u003d $.map(report.data, (row, idx)\u003d\u003e{ return row.supplier_name })\r\n\r\n\t\t// Create a dialog window for the user to pick their supplier\r\n\t\tlet dialog \u003d new frappe.ui.Dialog({\r\n\t\t\ttitle: __(\u0027Select Default Supplier\u0027),\r\n\t\t\tfields: [\r\n\t\t\t\t{\r\n\t\t\t\t\treqd: 1,\r\n\t\t\t\t\tlabel: \u0027Supplier\u0027,\r\n\t\t\t\t\tfieldtype: \u0027Link\u0027,\r\n\t\t\t\t\toptions: \u0027Supplier\u0027,\r\n\t\t\t\t\tfieldname: \u0027supplier\u0027,\r\n\t\t\t\t\tget_query: () \u003d\u003e {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tfilters: {\r\n\t\t\t\t\t\t\t\t\u0027name\u0027: [\u0027in\u0027, suppliers]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\r\n\r\n\t\tdialog.set_primary_action(\"Set Default Supplier\", () \u003d\u003e {\r\n\t\t\tlet values \u003d dialog.get_values();\r\n\t\t\tif(values) {\r\n\t\t\t\t// Set the default_supplier field of the appropriate Item to the selected supplier\r\n\t\t\t\tfrappe.call({\r\n\t\t\t\t\tmethod: \"frappe.client.set_value\",\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\tdoctype: \"Item\",\r\n\t\t\t\t\t\tname: item_code,\r\n\t\t\t\t\t\tfieldname: \"default_supplier\",\r\n\t\t\t\t\t\tvalue: values.supplier,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfreeze: true,\r\n\t\t\t\t\tcallback: (r) \u003d\u003e {\r\n\t\t\t\t\t\tfrappe.msgprint(\"Successfully Set Supplier\");\r\n\t\t\t\t\t\tdialog.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tdialog.show();\r\n\t}\r\n}\r\n\r\n\r\n","html_format":"\r\n\u003chead\u003e\r\n\t\r\n\t\r\n\t\u003clink href\u003d\"/assets/frappe/css/c3.min.css\" rel\u003d\"stylesheet\" type\u003d\"text/css\"\u003e\r\n\t\r\n\t\r\n\t\u003cscript type\u003d\"text/javascript\" src\u003d\"/assets/frappe/js/lib/d3.min.js\"\u003e\u003c/script\u003e\r\n\t\u003cscript type\u003d\"text/javascript\" src\u003d\"/assets/frappe/js/lib/c3.min.js\"\u003e\u003c/script\u003e\r\n    \u003cscript type\u003d\"text/javascript\"\u003e\r\n\r\n\t\tonReady(\"#chart_div\", function() {\r\n\t\t\tvar chartData \u003d [];\r\n\t\t\t{% var q \u003d 0; %}\r\n\t\t\t{% for(var j\u003d0, m\u003ddata.length+1; j\u003cm; j++) { %}\r\n\t\t\t\r\n\t\t\t\tvar tempData{%\u003dj%} \u003d [];\r\n\t\t\t\t\r\n\t\t\t\t{% for(var i\u003d1, l\u003dreport.columns.length; i\u003cl; i++) { %}\r\n\t\t\t\t\t{% if(__(report.columns[i].label) !\u003d __(\"Quotation\")) { %}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t{% if(j \u003d\u003d 0) { %}\r\n\t\t\t\t\t\t\t{% if(i \u003d\u003d 1) { %}\r\n\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d \\\"x\\\";\r\n\t\t\t\t\t\t\t{% } else { %}\r\n\r\n\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d Math.log(parseInt(\\\"{%\u003d report.columns[i].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))) / Math.LN10;\r\n\t\t\t\t\t\t\t{% } %}\r\n\t\t\t\t\t\t{% } else { %}\r\n\t\t\t\t\t\t\t{% if(i \u003d\u003d 1) { %}\r\n\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d \\\"{%\u003d data[j-1][report.columns[i].field] %} \\\";\r\n\t\t\t\t\t\t\t{% } else { %}\r\n\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d {% if(data[j-1][report.columns[i].field] \u003d\u003d \"\") { if (i \u003e 2) { %} \r\n\t\t\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-2] \r\n\t\t\t\t\t\t\t\t\t{% } else { %} \r\n\t\t\t\t\t\t\t\t\t\t0 \r\n\t\t\t\t\t\t\t\t{% } } else { %} \r\n\t\t\t\t\t\t\t\t\t{%\u003d data[j-1][report.columns[i].field] %} \r\n\t\t\t\t\t\t\t{% } %};\r\n\t\t\t\t\t\t\t{% } %};\r\n\t\t\t\t\t\t{% } %}\r\n\t\t\t\t\t{% } else { %}\r\n\t\t\t\t\t\t{% if(j \u003d\u003d 0) { %}\r\n\t\t\t\t\t\t\t{% if(i \u003c l-1) { %}\r\n\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d Math.log(parseInt(\\\"{%\u003d report.columns[i+1].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))-1) / Math.LN10;\r\n\t\t\t\t\t\t\t{% } else { %}\r\n\t\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d Math.log(2*parseInt(\\\"{%\u003d report.columns[i-1].label %}\\\".replace(\\\"Qty: \\\",\\\"\\\"))) / Math.LN10;\r\n\t\t\t\t\t\t\t{% } %}\r\n\t\t\t\t\t\t{% } else { %}\r\n\r\n\t\t\t\t\t\t\ttempData{%\u003dj%}[{%\u003di%}-1] \u003d tempData{%\u003dj%}[{%\u003di%}-2];\r\n\t\t\t\t\t\t{% } %}\r\n\r\n\t\t\t\t\t{% } %}\r\n\t\t\t\t\t\r\n\t\t\t\t{% } %}\r\n\t\t\t\tchartData[{%\u003dj%}] \u003d tempData{%\u003dj%};\r\n\t\t\t{% } %}\r\n\t\t\tconsole.log(chartData);\r\n\t\t\t\r\n\t\t\thold \u003d {\r\n\t\t\tbindto: \"#chart_div\" ,data: {\r\n\t\t\t\tx: \"x\",\r\n\t\t\t\tcolumns: chartData\r\n\t\t\t},\r\n\t\t\taxis: {\r\n\t\t\t\tx: {\r\n\t\t\t\t\ttick: {\r\n\t\t\t\t\t   format: function (x22) { return Math.pow(10,x22).toFixed(0); },\r\n\t\t\t\t\t\tculling: {\r\n\t\t\t\t\t\t\tmax: {%\u003dreport.columns.length%} / 2\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpoint: {\r\n\t\t\t  show: false\r\n\t\t\t}\r\n\t\t\t};\r\n\t\t\tconsole.log(hold);\r\n\t\t\tvar chart \u003d c3.generate(hold);\r\n\t\t});\r\n\t\t\r\n\t\tfunction onReady(selector, callback) {\r\n        var intervalID \u003d window.setInterval(function() {\r\n          if (document.querySelector(selector) !\u003d\u003d undefined) {\r\n            window.clearInterval(intervalID);\r\n            callback.call(this);\r\n          }\r\n        }, 500);}\r\n\t\t\t\t\r\n\t\t\r\n    \u003c/script\u003e\r\n\r\n \u003c/head\u003e\r\n\u003cdiv style\u003d\"margin-bottom: 7px;\" class\u003d\"text-center\"\u003e\r\n\t{%\u003d frappe.boot.letter_heads[frappe.defaults.get_default(\"letter_head\")] %}\r\n\u003c/div\u003e\r\n\u003ch2 class\u003d\"text-center\"\u003e{%\u003d __(report.report_name) %}\u003c/h2\u003e\r\n\u003ch4 class\u003d\"text-center\"\u003e{%\u003d filters.item %} \u003c/h4\u003e\r\n\r\n\u003chr\u003e\r\n\u003ctable class\u003d\"table table-bordered\"\u003e\r\n\t\u003cthead\u003e\r\n\t\t\u003ctr\u003e\r\n\t\t\t{% for(var i\u003d0, l\u003dreport.columns.length; i\u003cl; i++) { %}\r\n\t\t\t\t\u003cth style\u003d\"width: 15%\"\u003e{%\u003d report.columns[i].label %}\u003c/th\u003e\r\n\t\t\t{% } %}\r\n\r\n\t\t\u003c/tr\u003e\r\n\t\u003c/thead\u003e\r\n\t\u003ctbody\u003e\r\n\r\n\t\t{% for(var i\u003d0, l\u003ddata.length; i\u003cl; i++) { %}\r\n\t\t\t\u003ctr\u003e\r\n\t\t\t\r\n\t\t\t\t{% for(var j\u003d0,m\u003dreport.columns.length; j\u003cm; j++) { %}\r\n\t\t\t\t\t\u003ctd style\u003d\"width: 15%\"\u003e{%\u003d data[i][report.columns[j].field] %}\u003c/td\u003e\r\n\t\t\t\t{% } %}\r\n\r\n\t\t\u003c/tr\u003e\r\n\t\t{% } %}\r\n\t\u003c/tbody\u003e\r\n\u003c/table\u003e\r\n\r\n\u003ch4 class\u003d\"text-center\"\u003e Analysis Chart \u003c/h4\u003e\r\n\u003cdiv id\u003d\"chart_div\"\u003e\u003c/div\u003e\r\n\r\n\r\n\t\t\r\n\u003cp class\u003d\"text-right text-muted\"\u003ePrinted On {%\u003d dateutil.str_to_user(dateutil.get_datetime_as_string()) %}\u003c/p\u003e"}}
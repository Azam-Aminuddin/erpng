{"docs":[{"allow_copy":1.0,"allow_guest_to_view":0.0,"allow_import":1.0,"allow_rename":0.0,"autoname":"OP-.######","beta":1.0,"creation":"2017-05-04 11:52:40.941507","custom":0.0,"docstatus":0.0,"doctype":"DocType","document_type":"Document","editable_grid":0.0,"engine":"InnoDB","fields":[{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"patient","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":1.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":1.0,"label":"Patient","length":0.0,"no_copy":0.0,"options":"Patient","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":1.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"physician","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":1.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":1.0,"label":"Physician","length":0.0,"no_copy":0.0,"options":"Physician","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":1.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"appointment_date","fieldtype":"Date","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":1.0,"label":"Date","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":1.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"eval:doc.__islocal","fieldname":"check_availability","fieldtype":"Button","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Check availability","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"column_break_1","fieldtype":"Column Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"default":"Scheduled","fieldname":"status","fieldtype":"Select","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":0.0,"label":"Status","length":0.0,"no_copy":0.0,"options":"\nScheduled\nOpen\nClosed\nPending\nCancelled","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":1.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":1.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"appointment_type","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":1.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Type","length":0.0,"no_copy":0.0,"options":"Appointment Type","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"section_break_1","fieldtype":"Section Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"appointment_time","fieldtype":"Time","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Time","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"description":"In Minutes","fieldname":"duration","fieldtype":"Int","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Duration","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"appointment_datetime","fieldtype":"Datetime","hidden":1.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Date TIme","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":1.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":1.0,"reqd":0.0,"search_index":1.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"column_break_2","fieldtype":"Column Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"department","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":1.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":1.0,"label":"Department","length":0.0,"no_copy":0.0,"options":"Medical Department","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":1.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"sales_invoice","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Sales Invoice","length":0.0,"no_copy":0.0,"options":"Sales Invoice","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":1.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":1.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"section_break_2","fieldtype":"Section Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"patient_details","fieldtype":"Section Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Patient Details","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"patient","fieldname":"patient_name","fieldtype":"Data","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Patient Name","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":1.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"patient_sex","fieldtype":"Data","hidden":1.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Gender","length":0.0,"no_copy":1.0,"options":"patient.sex","permlevel":0.0,"precision":"","print_hide":1.0,"print_hide_if_no_value":0.0,"read_only":1.0,"remember_last_selected_value":0.0,"report_hide":1.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"patient_age","fieldtype":"Data","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Patient Age","length":0.0,"no_copy":0.0,"options":"","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":1.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"company","fieldtype":"Link","hidden":1.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Company","length":0.0,"no_copy":1.0,"options":"Company","permlevel":0.0,"precision":"","print_hide":1.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":1.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":1.0,"columns":0.0,"fieldname":"section_break_3","fieldtype":"Section Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"More Info","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"notes","fieldtype":"Small Text","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":1.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Notes","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"referring_physician","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":1.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Referring Physician","length":0.0,"no_copy":0.0,"options":"Physician","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":1.0,"unique":0.0},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"default":"0","fieldname":"reminded","fieldtype":"Check","hidden":1.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Reminded","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":1.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":1.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0}],"has_web_view":0.0,"hide_heading":0.0,"hide_toolbar":0.0,"idx":0.0,"image_view":0.0,"in_create":0.0,"is_submittable":0.0,"issingle":0.0,"istable":0.0,"max_attachments":0.0,"modified":"2017-10-05 12:13:03.204936","modified_by":"Administrator","module":"Healthcare","name":"Patient Appointment","name_case":"","owner":"Administrator","permissions":[{"amend":0.0,"apply_user_permissions":0.0,"cancel":0.0,"create":1.0,"delete":1.0,"email":1.0,"export":1.0,"if_owner":0.0,"import":0.0,"permlevel":0.0,"print":1.0,"read":1.0,"report":1.0,"role":"Healthcare Administrator","set_user_permissions":0.0,"share":1.0,"submit":0.0,"write":1.0},{"amend":0.0,"apply_user_permissions":0.0,"cancel":0.0,"create":1.0,"delete":1.0,"email":1.0,"export":1.0,"if_owner":0.0,"import":0.0,"permlevel":0.0,"print":1.0,"read":1.0,"report":1.0,"role":"Physician","set_user_permissions":0.0,"share":1.0,"submit":0.0,"write":1.0}],"quick_entry":0.0,"read_only":0.0,"read_only_onload":0.0,"restrict_to_domain":"Healthcare","search_fields":"patient, physician, appointment_datetime,department","show_name_in_global_search":1.0,"sort_field":"modified","sort_order":"DESC","title_field":"patient","track_changes":1.0,"track_seen":1.0,"__js":"// Copyright (c) 2016, ESS LLP and contributors\r\n// For license information, please see license.txt\r\nfrappe.provide(\"erpnext.queries\");\r\nfrappe.ui.form.on(\u0027Patient Appointment\u0027, {\r\n\tsetup: function(frm) {\r\n\t\tfrm.custom_make_buttons \u003d {\r\n\t\t\t\u0027Sales Invoice\u0027: \u0027Invoice\u0027,\r\n\t\t\t\u0027Vital Signs\u0027: \u0027Vital Signs\u0027,\r\n\t\t\t\u0027Consultation\u0027: \u0027Consultation\u0027\r\n\t\t};\r\n\t},\r\n\trefresh: function(frm) {\r\n\t\tfrm.set_query(\"patient\", function () {\r\n\t\t\treturn {\r\n\t\t\t\tfilters: {\"disabled\": 0}\r\n\t\t\t};\r\n\t\t});\r\n\t\tif(frm.doc.patient){\r\n\t\t\tfrm.add_custom_button(__(\u0027Medical Record\u0027), function() {\r\n\t\t\t\tfrappe.route_options \u003d {\"patient\": frm.doc.patient};\r\n\t\t\t\tfrappe.set_route(\"medical_record\");\r\n\t\t\t},__(\"View\"));\r\n\t\t}\r\n\t\tif(frm.doc.status \u003d\u003d \"Open\"){\r\n\t\t\tfrm.add_custom_button(__(\u0027Cancel\u0027), function() {\r\n\t\t\t\tbtn_update_status(frm, \"Cancelled\");\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(frm.doc.status \u003d\u003d \"Scheduled\" \u0026\u0026 !frm.doc.__islocal){\r\n\t\t\tfrm.add_custom_button(__(\u0027Cancel\u0027), function() {\r\n\t\t\t\tbtn_update_status(frm, \"Cancelled\");\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(frm.doc.status \u003d\u003d \"Pending\"){\r\n\t\t\tfrm.add_custom_button(__(\u0027Set Open\u0027), function() {\r\n\t\t\t\tbtn_update_status(frm, \"Open\");\r\n\t\t\t});\r\n\t\t\tfrm.add_custom_button(__(\u0027Cancel\u0027), function() {\r\n\t\t\t\tbtn_update_status(frm, \"Cancelled\");\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfrm.add_custom_button(__(\"Consultation\"),function(){\r\n\t\t\tbtn_create_consultation(frm);\r\n\t\t},\"Create\");\r\n\r\n\t\tfrm.add_custom_button(__(\u0027Vital Signs\u0027), function() {\r\n\t\t\tbtn_create_vital_signs(frm);\r\n\t\t},\"Create\");\r\n\r\n\t\tif(!frm.doc.__islocal){\r\n\t\t\tif(frm.doc.sales_invoice \u0026\u0026 frappe.user.has_role(\"Accounts User\")){\r\n\t\t\t\tfrm.add_custom_button(__(\u0027Invoice\u0027), function() {\r\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Sales Invoice\", frm.doc.sales_invoice);\r\n\t\t\t\t},__(\"View\") );\r\n\t\t\t}\r\n\t\t\telse if(frm.doc.status !\u003d \"Cancelled\" \u0026\u0026 frappe.user.has_role(\"Accounts User\")){\r\n\t\t\t\tfrm.add_custom_button(__(\u0027Invoice\u0027), function() {\r\n\t\t\t\t\tbtn_invoice_consultation(frm);\r\n\t\t\t\t},__(\"Create\"));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcheck_availability: function(frm) {\r\n\t\tvar { physician, appointment_date } \u003d frm.doc;\r\n\t\tif(!(physician \u0026\u0026 appointment_date)) {\r\n\t\t\tfrappe.throw(__(\"Please select Physician and Date\"));\r\n\t\t}\r\n\r\n\t\t// show booking modal\r\n\t\tfrm.call({\r\n\t\t\tmethod: \u0027get_availability_data\u0027,\r\n\t\t\targs: {\r\n\t\t\t\tphysician: physician,\r\n\t\t\t\tdate: appointment_date\r\n\t\t\t},\r\n\t\t\tcallback: (r) \u003d\u003e {\r\n\t\t\t\t// console.log(r);\r\n\t\t\t\tvar data \u003d r.message;\r\n\t\t\t\tif(data.available_slots.length \u003e 0) {\r\n\t\t\t\t\tshow_availability(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshow_empty_state();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction show_empty_state() {\r\n\t\t\tfrappe.msgprint({\r\n\t\t\t\ttitle: __(\u0027Not Available\u0027),\r\n\t\t\t\tmessage: __(\"Physician {0} not available on {1}\", [physician.bold(), appointment_date.bold()]),\r\n\t\t\t\tindicator: \u0027red\u0027\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction show_availability(data) {\r\n\t\t\tvar d \u003d new frappe.ui.Dialog({\r\n\t\t\t\ttitle: __(\"Available slots\"),\r\n\t\t\t\tfields: [{ fieldtype: \u0027HTML\u0027, fieldname: \u0027available_slots\u0027}],\r\n\t\t\t\tprimary_action_label: __(\"Book\"),\r\n\t\t\t\tprimary_action: function() {\r\n\t\t\t\t\t// book slot\r\n\t\t\t\t\tfrm.set_value(\u0027appointment_time\u0027, selected_slot);\r\n\t\t\t\t\tfrm.set_value(\u0027duration\u0027, data.time_per_appointment);\r\n\t\t\t\t\td.hide();\r\n\t\t\t\t\tfrm.save();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar $wrapper \u003d d.fields_dict.available_slots.$wrapper;\r\n\t\t\tvar selected_slot \u003d null;\r\n\r\n\t\t\t// disable dialog action initially\r\n\t\t\td.get_primary_btn().attr(\u0027disabled\u0027, true);\r\n\r\n\t\t\t// make buttons for each slot\r\n\t\t\tvar slot_html \u003d data.available_slots.map(slot \u003d\u003e {\r\n\t\t\t\treturn `\u003cbutton class\u003d\"btn btn-default\"\r\n\t\t\t\t\tdata-name\u003d${slot.from_time}\r\n\t\t\t\t\tstyle\u003d\"margin: 0 10px 10px 0; width: 72px\"\u003e\r\n\t\t\t\t\t${slot.from_time.substring(0, slot.from_time.length - 3)}\r\n\t\t\t\t\u003c/button\u003e`;\r\n\t\t\t}).join(\"\");\r\n\r\n\t\t\t$wrapper\r\n\t\t\t\t.css(\u0027margin-bottom\u0027, 0)\r\n\t\t\t\t.addClass(\u0027text-center\u0027)\r\n\t\t\t\t.html(slot_html);\r\n\r\n\t\t\t// disable buttons for which appointments are booked\r\n\t\t\tdata.appointments.map(slot \u003d\u003e {\r\n\t\t\t\tif(slot.status \u003d\u003d \"Scheduled\" || slot.status \u003d\u003d \"Open\" || slot.status \u003d\u003d \"Closed\"){\r\n\t\t\t\t\t$wrapper\r\n\t\t\t\t\t\t.find(`button[data-name\u003d\"${slot.appointment_time}\"]`)\r\n\t\t\t\t\t\t.attr(\u0027disabled\u0027, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// blue button when clicked\r\n\t\t\t$wrapper.on(\u0027click\u0027, \u0027button\u0027, function() {\r\n\t\t\t\tvar $btn \u003d $(this);\r\n\t\t\t\t$wrapper.find(\u0027button\u0027).removeClass(\u0027btn-primary\u0027);\r\n\t\t\t\t$btn.addClass(\u0027btn-primary\u0027);\r\n\t\t\t\tselected_slot \u003d $btn.attr(\u0027data-name\u0027);\r\n\r\n\t\t\t\t// enable dialog action\r\n\t\t\t\td.get_primary_btn().attr(\u0027disabled\u0027, null);\r\n\t\t\t});\r\n\r\n\t\t\td.show();\r\n\t\t}\r\n\t},\r\n\tonload:function(frm){\r\n\t\tif(frm.is_new()) {\r\n\t\t\tfrm.set_value(\"appointment_time\", null);\r\n\t\t\tfrm.disable_save();\r\n\t\t}\r\n\t},\r\n});\r\n\r\nvar btn_create_consultation \u003d function(frm){\r\n\tvar doc \u003d frm.doc;\r\n\tfrappe.call({\r\n\t\tmethod:\"erpnext.healthcare.doctype.patient_appointment.patient_appointment.create_consultation\",\r\n\t\targs: {appointment: doc.name},\r\n\t\tcallback: function(data){\r\n\t\t\tif(!data.exc){\r\n\t\t\t\tvar doclist \u003d frappe.model.sync(data.message);\r\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n\r\nvar btn_create_vital_signs \u003d function (frm) {\r\n\tif(!frm.doc.patient){\r\n\t\tfrappe.throw(\"Please select patient\");\r\n\t}\r\n\tfrappe.route_options \u003d {\r\n\t\t\"patient\": frm.doc.patient,\r\n\t};\r\n\tfrappe.new_doc(\"Vital Signs\");\r\n};\r\n\r\nvar btn_update_status \u003d function(frm, status){\r\n\tvar doc \u003d frm.doc;\r\n\tfrappe.confirm(__(\u0027Are you sure you want to cancel this appointment?\u0027),\r\n\t\tfunction() {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod:\r\n\t\t\t\t\"erpnext.healthcare.doctype.patient_appointment.patient_appointment.update_status\",\r\n\t\t\t\targs: {appointmentId: doc.name, status:status},\r\n\t\t\t\tcallback: function(data){\r\n\t\t\t\t\tif(!data.exc){\r\n\t\t\t\t\t\tfrm.reload_doc();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t);\r\n};\r\n\r\nvar btn_invoice_consultation \u003d function(frm){\r\n\tvar doc \u003d frm.doc;\r\n\tfrappe.call({\r\n\t\tmethod:\r\n\t\t\"erpnext.healthcare.doctype.patient_appointment.patient_appointment.create_invoice\",\r\n\t\targs: {company: doc.company, physician:doc.physician, patient: doc.patient,\r\n\t\t\tappointment_id: doc.name, appointment_date:doc.appointment_date },\r\n\t\tcallback: function(data){\r\n\t\t\tif(!data.exc){\r\n\t\t\t\tif(data.message){\r\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Sales Invoice\", data.message);\r\n\t\t\t\t}\r\n\t\t\t\tcur_frm.reload_doc();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n\r\nfrappe.ui.form.on(\"Patient Appointment\", \"physician\", function(frm) {\r\n\tif(frm.doc.physician){\r\n\t\tfrappe.call({\r\n\t\t\t\"method\": \"frappe.client.get\",\r\n\t\t\targs: {\r\n\t\t\t\tdoctype: \"Physician\",\r\n\t\t\t\tname: frm.doc.physician\r\n\t\t\t},\r\n\t\t\tcallback: function (data) {\r\n\t\t\t\tfrappe.model.set_value(frm.doctype,frm.docname, \"department\",data.message.department);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\nfrappe.ui.form.on(\"Patient Appointment\", \"patient\", function(frm) {\r\n\tif(frm.doc.patient){\r\n\t\tfrappe.call({\r\n\t\t\t\"method\": \"frappe.client.get\",\r\n\t\t\targs: {\r\n\t\t\t\tdoctype: \"Patient\",\r\n\t\t\t\tname: frm.doc.patient\r\n\t\t\t},\r\n\t\t\tcallback: function (data) {\r\n\t\t\t\tvar age \u003d null;\r\n\t\t\t\tif(data.message.dob){\r\n\t\t\t\t\tage \u003d calculate_age(data.message.dob);\r\n\t\t\t\t}\r\n\t\t\t\tfrappe.model.set_value(frm.doctype,frm.docname, \"patient_age\", age);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\nvar calculate_age \u003d function(birth) {\r\n\tvar ageMS \u003d Date.parse(Date()) - Date.parse(birth);\r\n\tvar age \u003d new Date();\r\n\tage.setTime(ageMS);\r\n\tvar years \u003d  age.getFullYear() - 1970;\r\n\treturn  years + \" Year(s) \" + age.getMonth() + \" Month(s) \" + age.getDate() + \" Day(s)\";\r\n};\r\n","__list_js":"/*\r\n(c) ESS 2015-16\r\n*/\r\nfrappe.listview_settings[\u0027Patient Appointment\u0027] \u003d {\r\n\tfilters: [[\"status\", \"\u003d\", \"Open\"]],\r\n};\r\n","__calendar_js":"\r\nfrappe.views.calendar[\"Patient Appointment\"] \u003d {\r\n\tfield_map: {\r\n\t\t\"start\": \"start\",\r\n\t\t\"end\": \"end\",\r\n\t\t\"id\": \"name\",\r\n\t\t\"title\": \"patient\",\r\n\t\t\"allDay\": \"allDay\"\r\n\t},\r\n\tgantt: true,\r\n\tget_events_method: \"erpnext.healthcare.doctype.patient_appointment.patient_appointment.get_events\",\r\n\tfilters: [\r\n\t\t{\r\n\t\t\t\u0027fieldtype\u0027: \u0027Link\u0027,\r\n\t\t\t\u0027fieldname\u0027: \u0027physician\u0027,\r\n\t\t\t\u0027options\u0027: \u0027Physician\u0027,\r\n\t\t\t\u0027label\u0027: __(\u0027Physician\u0027)\r\n\t\t},\r\n\t\t{\r\n\t\t\t\u0027fieldtype\u0027: \u0027Link\u0027,\r\n\t\t\t\u0027fieldname\u0027: \u0027patient\u0027,\r\n\t\t\t\u0027options\u0027: \u0027Patient\u0027,\r\n\t\t\t\u0027label\u0027: __(\u0027Patient\u0027)\r\n\t\t},\r\n\t\t{\r\n\t\t\t\u0027fieldtype\u0027: \u0027Link\u0027,\r\n\t\t\t\u0027fieldname\u0027: \u0027appointment_type\u0027,\r\n\t\t\t\u0027options\u0027: \u0027Appointment Type\u0027,\r\n\t\t\t\u0027label\u0027: __(\u0027Appointment Type\u0027)\r\n\t\t},\r\n\t\t{\r\n\t\t\t\u0027fieldtype\u0027: \u0027Link\u0027,\r\n\t\t\t\u0027fieldname\u0027: \u0027department\u0027,\r\n\t\t\t\u0027options\u0027: \u0027Medical Department\u0027,\r\n\t\t\t\u0027label\u0027: __(\u0027Department\u0027)\r\n\t\t},\r\n\t\t{\r\n\t\t\t\u0027fieldtype\u0027: \u0027Select\u0027,\r\n\t\t\t\u0027fieldname\u0027: \u0027status\u0027,\r\n\t\t\t\u0027options\u0027: \u0027Scheduled\\nOpen\\nClosed\\nPending\u0027,\r\n\t\t\t\u0027label\u0027: __(\u0027Status\u0027)\r\n\t\t}\r\n\t]\r\n};\r\n"}],"user_settings":"{}"}
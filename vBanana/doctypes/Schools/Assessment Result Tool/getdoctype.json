{"docs":[{"allow_copy":1,"allow_guest_to_view":0,"allow_import":0,"allow_rename":0,"beta":0,"creation":"2017-01-05 12:27:48.951036","custom":0,"docstatus":0,"doctype":"DocType","document_type":"","editable_grid":1,"engine":"InnoDB","fields":[{"allow_bulk_edit":0,"allow_on_submit":0,"bold":0,"collapsible":0,"columns":0,"default":"","fieldname":"assessment_plan","fieldtype":"Link","hidden":0,"ignore_user_permissions":0,"ignore_xss_filter":0,"in_filter":0,"in_global_search":0,"in_list_view":1,"in_standard_filter":0,"label":"Assessment Plan","length":0,"no_copy":0,"options":"Assessment Plan","permlevel":0,"precision":"","print_hide":0,"print_hide_if_no_value":0,"read_only":0,"remember_last_selected_value":0,"report_hide":0,"reqd":1,"search_index":0,"set_only_once":0,"unique":0,"doctype":"DocField","name":"1q0s4pdf8f","docstatus":0,"idx":0,"parenttype":"DocType","parentfield":"fields","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"},{"allow_bulk_edit":0,"allow_on_submit":0,"bold":0,"collapsible":0,"columns":0,"fieldname":"column_break_2","fieldtype":"Column Break","hidden":0,"ignore_user_permissions":0,"ignore_xss_filter":0,"in_filter":0,"in_global_search":0,"in_list_view":0,"in_standard_filter":0,"length":0,"no_copy":0,"permlevel":0,"precision":"","print_hide":0,"print_hide_if_no_value":0,"read_only":0,"remember_last_selected_value":0,"report_hide":0,"reqd":0,"search_index":0,"set_only_once":0,"unique":0,"doctype":"DocField","name":"4ekk9kr0dv","docstatus":0,"idx":1,"parenttype":"DocType","parentfield":"fields","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"},{"allow_bulk_edit":0,"allow_on_submit":0,"bold":0,"collapsible":0,"columns":0,"fieldname":"student_group","fieldtype":"Link","hidden":0,"ignore_user_permissions":0,"ignore_xss_filter":0,"in_filter":0,"in_global_search":0,"in_list_view":1,"in_standard_filter":0,"label":"Student Group","length":0,"no_copy":0,"options":"Student Group","permlevel":0,"precision":"","print_hide":0,"print_hide_if_no_value":0,"read_only":1,"remember_last_selected_value":0,"report_hide":0,"reqd":1,"search_index":0,"set_only_once":0,"unique":0,"doctype":"DocField","name":"1j1j4gcplq","docstatus":0,"idx":2,"parenttype":"DocType","parentfield":"fields","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"},{"allow_bulk_edit":0,"allow_on_submit":0,"bold":0,"collapsible":0,"columns":0,"depends_on":"assessment_plan","fieldname":"section_break_5","fieldtype":"Section Break","hidden":0,"ignore_user_permissions":0,"ignore_xss_filter":0,"in_filter":0,"in_global_search":0,"in_list_view":0,"in_standard_filter":0,"length":0,"no_copy":0,"permlevel":0,"precision":"","print_hide":0,"print_hide_if_no_value":0,"read_only":0,"remember_last_selected_value":0,"report_hide":0,"reqd":0,"search_index":0,"set_only_once":0,"unique":0,"doctype":"DocField","name":"5jsld6cqpo","docstatus":0,"idx":3,"parenttype":"DocType","parentfield":"fields","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"},{"allow_bulk_edit":0,"allow_on_submit":0,"bold":0,"collapsible":0,"columns":0,"fieldname":"result_html","fieldtype":"HTML","hidden":0,"ignore_user_permissions":0,"ignore_xss_filter":0,"in_filter":0,"in_global_search":0,"in_list_view":0,"in_standard_filter":0,"label":"Result HTML","length":0,"no_copy":0,"permlevel":0,"precision":"","print_hide":0,"print_hide_if_no_value":0,"read_only":0,"remember_last_selected_value":0,"report_hide":0,"reqd":0,"search_index":0,"set_only_once":0,"unique":0,"doctype":"DocField","name":"4nugnu3ls2","docstatus":0,"idx":4,"parenttype":"DocType","parentfield":"fields","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"}],"has_web_view":0,"hide_heading":1,"hide_toolbar":1,"idx":0.0,"image_view":0,"in_create":0,"is_submittable":0,"issingle":1,"istable":0,"max_attachments":0,"modified":"2017-06-30 08:21:47.184562","modified_by":"Administrator","module":"Schools","name":"Assessment Result Tool","name_case":"","owner":"Administrator","permissions":[{"amend":0.0,"apply_user_permissions":0.0,"cancel":0.0,"create":1.0,"delete":0.0,"email":1.0,"export":0.0,"if_owner":0.0,"import":0.0,"permlevel":0.0,"print":1.0,"read":1.0,"report":0.0,"role":"Academics User","set_user_permissions":0.0,"share":1.0,"submit":0.0,"write":1.0,"doctype":"DocPerm","name":"7q4nbb1psr","docstatus":0,"idx":0,"parenttype":"DocType","parentfield":"permissions","parent":"Assessment Result Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-26 17:58:36.008","modified":"2017-10-26 17:58:36.008"}],"quick_entry":1,"read_only":0,"read_only_onload":0,"restrict_to_domain":"Education","show_name_in_global_search":0,"sort_field":"modified","sort_order":"DESC","track_changes":0,"track_seen":0,"__js":"// Copyright (c) 2016, Frappe Technologies Pvt. Ltd. and contributors\r\n// For license information, please see license.txt\r\n\r\n\r\nfrappe.ui.form.on(\u0027Assessment Result Tool\u0027, {\r\n\tsetup: function(frm) {\r\n\t\tfrm.add_fetch(\"assessment_plan\", \"student_group\", \"student_group\");\r\n\t},\r\n\r\n\trefresh: function(frm) {\r\n\t\tif (frappe.route_options) {\r\n\t\t\tfrm.set_value(\"student_group\", frappe.route_options.student_group);\r\n\t\t\tfrm.set_value(\"assessment_plan\", frappe.route_options.assessment_plan);\r\n\t\t\tfrappe.route_options \u003d null;\r\n\t\t}\r\n\t\tfrm.disable_save();\r\n\t\tfrm.page.clear_indicator();\r\n\t\tfrm.trigger(\"assessment_plan\");\r\n\t},\r\n\r\n\tassessment_plan: function(frm) {\r\n\t\tfrm.doc.show_submit \u003d false;\r\n\t\tif(frm.doc.assessment_plan) {\r\n\t\t\tif (!frm.doc.student_group)\r\n\t\t\t\treturn\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"erpnext.schools.api.get_assessment_students\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"assessment_plan\": frm.doc.assessment_plan,\r\n\t\t\t\t\t\"student_group\": frm.doc.student_group\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tfrm.doc.students \u003d r.message;\r\n\t\t\t\t\tfrm.events.render_table(frm);\r\n\t\t\t\t\tfor (let value of r.message) {\r\n\t\t\t\t\t\tif (!value.docstatus) {\r\n\t\t\t\t\t\t\tfrm.doc.show_submit \u003d true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrm.events.submit_result(frm);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\trender_table: function(frm) {\r\n\t\t$(frm.fields_dict.result_html.wrapper).empty();\r\n\t\tlet assessment_plan \u003d frm.doc.assessment_plan;\r\n\t\tfrappe.call({\r\n\t\t\tmethod: \"erpnext.schools.api.get_assessment_details\",\r\n\t\t\targs: {\r\n\t\t\t\tassessment_plan: assessment_plan\r\n\t\t\t},\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tfrm.events.get_marks(frm, r.message);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tget_marks: function(frm, criteria_list) {\r\n\t\tlet max_total_score \u003d 0;\r\n\t\tcriteria_list.forEach(function(c) {\r\n\t\t\tmax_total_score +\u003d c.maximum_score\r\n\t\t});\r\n\t\tvar result_table \u003d $(frappe.render_template(\u0027assessment_result_tool\u0027, {\r\n\t\t\tfrm: frm,\r\n\t\t\tstudents: frm.doc.students,\r\n\t\t\tcriteria: criteria_list,\r\n\t\t\tmax_total_score: max_total_score\r\n\t\t}));\r\n\t\tresult_table.appendTo(frm.fields_dict.result_html.wrapper);\r\n\r\n\t\tresult_table.on(\u0027change\u0027, \u0027input\u0027, function(e) {\r\n\t\t\tlet $input \u003d $(e.target);\r\n\t\t\tlet student \u003d $input.data().student;\r\n\t\t\tlet max_score \u003d $input.data().maxScore;\r\n\t\t\tlet value \u003d $input.val();\r\n\t\t\tif(value \u003c 0) {\r\n\t\t\t\t$input.val(0);\r\n\t\t\t} else if(value \u003e max_score) {\r\n\t\t\t\t$input.val(max_score);\r\n\t\t\t}\r\n\t\t\tlet total_score \u003d 0;\r\n\t\t\tlet student_scores \u003d {};\r\n\t\t\tstudent_scores[\"assessment_details\"] \u003d {}\r\n\t\t\tresult_table.find(`input[data-student\u003d${student}].student-result-data`)\r\n\t\t\t\t.each(function(el, input) {\r\n\t\t\t\t\tlet $input \u003d $(input);\r\n\t\t\t\t\tlet criteria \u003d $input.data().criteria;\r\n\t\t\t\t\tlet value \u003d parseFloat($input.val());\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tstudent_scores[\"assessment_details\"][criteria] \u003d value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttotal_score +\u003d value;\r\n\t\t\t});\r\n\t\t\tif(!Number.isNaN(total_score)) {\r\n\t\t\t\tresult_table.find(`span[data-student\u003d${student}].total-score`).html(total_score);\r\n\t\t\t}\r\n\t\t\tif (Object.keys(student_scores[\"assessment_details\"]).length \u003d\u003d\u003d criteria_list.length) {\r\n\t\t\t\tstudent_scores[\"student\"] \u003d student;\r\n\t\t\t\tstudent_scores[\"total_score\"] \u003d total_score;\r\n\t\t\t\tresult_table.find(`[data-student\u003d${student}].result-comment`)\r\n\t\t\t\t\t.each(function(el, input){\r\n\t\t\t\t\tstudent_scores[\"comment\"] \u003d $(input).val();\r\n\t\t\t\t});\r\n\t\t\t\tfrappe.call({\r\n\t\t\t\t\tmethod: \"erpnext.schools.api.mark_assessment_result\",\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\"assessment_plan\": frm.doc.assessment_plan,\r\n\t\t\t\t\t\t\"scores\": student_scores\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\tlet assessment_result \u003d r.message;\r\n\t\t\t\t\t\tif (!frm.doc.show_submit) {\r\n\t\t\t\t\t\t\tfrm.doc.show_submit \u003d true;\r\n\t\t\t\t\t\t\tfrm.events.submit_result;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (var criteria of Object.keys(assessment_result.details)) {\r\n\t\t\t\t\t\t\tresult_table.find(`[data-criteria\u003d${criteria}][data-student\u003d${assessment_result\r\n\t\t\t\t\t\t\t\t.student}].student-result-grade`).each(function(e1, input) {\r\n\t\t\t\t\t\t\t\t\t$(input).html(assessment_result.details[criteria]);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresult_table.find(`span[data-student\u003d${assessment_result.student}].total-score-grade`).html(assessment_result.grade);\r\n\t\t\t\t\t\tlet link_span \u003d result_table.find(`span[data-student\u003d${assessment_result.student}].total-result-link`);\r\n\t\t\t\t\t\t$(link_span).css(\"display\", \"block\");\r\n\t\t\t\t\t\t$(link_span).find(\"a\").attr(\"href\", \"#Form/Assessment Result/\"+assessment_result.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tsubmit_result: function(frm) {\r\n\t\tif (frm.doc.show_submit) {\r\n\t\t\tfrm.page.set_primary_action(__(\"Submit\"), function() {\r\n\t\t\t\tfrappe.call({\r\n\t\t\t\t\tmethod: \"erpnext.schools.api.submit_assessment_results\",\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\"assessment_plan\": frm.doc.assessment_plan,\r\n\t\t\t\t\t\t\"student_group\": frm.doc.student_group\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\t\tfrappe.msgprint(__(\"{0} Result submittted\", [r.message]));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfrappe.msgprint(__(\"No Result to submit\"));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfrm.events.assessment_plan(frm);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfrm.page.clear_primary_action();\r\n\t\t}\r\n\t}\r\n});\r\n"}],"user_settings":"{}"}
{"docs":[{"allow_copy":1.0,"allow_guest_to_view":0.0,"allow_import":0.0,"allow_rename":0.0,"beta":0.0,"creation":"2016-11-16 17:12:46.437539","custom":0.0,"docstatus":0.0,"doctype":"DocType","document_type":"","editable_grid":1.0,"engine":"InnoDB","fields":[{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"default":"","fieldname":"based_on","fieldtype":"Select","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Based On","length":0.0,"no_copy":0.0,"options":"Student Group\nCourse Schedule","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"7p8nnala7f","docstatus":0,"idx":0,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"default":"Batch","depends_on":"eval:doc.based_on \u003d\u003d \"Student Group\"","fieldname":"group_based_on","fieldtype":"Select","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Group Based On","length":0.0,"no_copy":0.0,"options":"Batch\nCourse\nActivity","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"6p8tdlm66c","docstatus":0,"idx":1,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"column_break_2","fieldtype":"Column Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"6pqiaq29us","docstatus":0,"idx":2,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"eval:doc.based_on \u003d\u003d\"Student Group\"","fieldname":"student_group","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":0.0,"label":"Student Group","length":0.0,"no_copy":0.0,"options":"Student Group","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"vt1uk4iug","docstatus":0,"idx":3,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"eval:doc.based_on \u003d\u003d\"Course Schedule\"","fieldname":"course_schedule","fieldtype":"Link","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":0.0,"label":"Course Schedule","length":0.0,"no_copy":0.0,"options":"Course Schedule","permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"7ilrkpk0af","docstatus":0,"idx":4,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"eval:doc.based_on \u003d\u003d\"Student Group\"","fieldname":"date","fieldtype":"Date","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":1.0,"in_standard_filter":0.0,"label":"Date","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":1.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"50qbd1u1pp","docstatus":0,"idx":5,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"depends_on":"eval: (doc.course_schedule \n|| (doc.student_group \u0026\u0026 doc.date))","fieldname":"attendance","fieldtype":"Section Break","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Attendance","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"7is391ulp2","docstatus":0,"idx":6,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"allow_bulk_edit":0.0,"allow_on_submit":0.0,"bold":0.0,"collapsible":0.0,"columns":0.0,"fieldname":"students_html","fieldtype":"HTML","hidden":0.0,"ignore_user_permissions":0.0,"ignore_xss_filter":0.0,"in_filter":0.0,"in_global_search":0.0,"in_list_view":0.0,"in_standard_filter":0.0,"label":"Students HTML","length":0.0,"no_copy":0.0,"permlevel":0.0,"precision":"","print_hide":0.0,"print_hide_if_no_value":0.0,"read_only":0.0,"remember_last_selected_value":0.0,"report_hide":0.0,"reqd":0.0,"search_index":0.0,"set_only_once":0.0,"unique":0.0,"doctype":"DocField","name":"37kuot6o8m","docstatus":0,"idx":7,"parenttype":"DocType","parentfield":"fields","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"}],"has_web_view":0.0,"hide_heading":1.0,"hide_toolbar":1.0,"idx":0.0,"image_view":0.0,"in_create":0.0,"is_submittable":0.0,"issingle":1.0,"istable":0.0,"max_attachments":0.0,"modified":"2017-06-30 08:21:51.390809","modified_by":"Administrator","module":"Schools","name":"Student Attendance Tool","name_case":"","owner":"Administrator","permissions":[{"amend":0.0,"apply_user_permissions":0.0,"cancel":0.0,"create":1.0,"delete":0.0,"email":0.0,"export":0.0,"if_owner":0.0,"import":0.0,"permlevel":0.0,"print":0.0,"read":1.0,"report":0.0,"role":"Instructor","set_user_permissions":0.0,"share":0.0,"submit":0.0,"write":1.0,"doctype":"DocPerm","name":"2gft1jl9rc","docstatus":0,"idx":0,"parenttype":"DocType","parentfield":"permissions","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"},{"amend":0.0,"apply_user_permissions":0.0,"cancel":0.0,"create":1.0,"delete":0.0,"email":1.0,"export":0.0,"if_owner":0.0,"import":0.0,"permlevel":0.0,"print":1.0,"read":1.0,"report":0.0,"role":"Academics User","set_user_permissions":0.0,"share":1.0,"submit":0.0,"write":1.0,"doctype":"DocPerm","name":"3on2j39vdh","docstatus":0,"idx":1,"parenttype":"DocType","parentfield":"permissions","parent":"Student Attendance Tool","owner":"Administrator","modified_by":"Administrator","creation":"2017-10-25 23:36:28.617","modified":"2017-10-25 23:36:28.617"}],"quick_entry":0.0,"read_only":0.0,"read_only_onload":0.0,"restrict_to_domain":"Education","show_name_in_global_search":0.0,"sort_field":"modified","sort_order":"DESC","track_changes":0.0,"track_seen":0.0,"__js":"// Copyright (c) 2016, Frappe Technologies Pvt. Ltd. and contributors\r\n// For license information, please see license.txt\r\nfrappe.provide(\"schools\")\r\n\r\nfrappe.ui.form.on(\u0027Student Attendance Tool\u0027, {\r\n\tonload: function(frm) {\r\n\t\tfrm.set_query(\"student_group\", function() {\r\n\t\t\treturn {\r\n\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\"group_based_on\": frm.doc.group_based_on\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\r\n\trefresh: function(frm) {\r\n\t\tif (frappe.route_options) {\r\n\t\t\tfrm.set_value(\"based_on\", frappe.route_options.based_on);\r\n\t\t\tfrm.set_value(\"student_group\", frappe.route_options.student_group);\r\n\t\t\tfrm.set_value(\"course_schedule\", frappe.route_options.course_schedule);\r\n\t\t\tfrappe.route_options \u003d null;\r\n\t\t}\r\n\t\tfrm.disable_save();\r\n\t},\r\n\r\n\tbased_on: function(frm) {\r\n\t\tif (frm.doc.based_on \u003d\u003d \"Student Group\") {\r\n\t\t\tfrm.set_value(\"course_schedule\", \"\");\r\n\t\t} else {\r\n\t\t\tfrm.set_value(\"student_group\", \"\");\r\n\t\t}\r\n\t},\r\n\r\n\tstudent_group: function(frm) {\r\n\t\tif ((frm.doc.student_group \u0026\u0026 frm.doc.date) || frm.doc.course_schedule) {\r\n\t\t\tvar method \u003d \"erpnext.schools.doctype.student_attendance_tool.student_attendance_tool.get_student_attendance_records\";\r\n\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: method,\r\n\t\t\t\targs: {\r\n\t\t\t\t\tbased_on: frm.doc.based_on,\r\n\t\t\t\t\tstudent_group: frm.doc.student_group,\r\n\t\t\t\t\tdate: frm.doc.date,\r\n\t\t\t\t\tcourse_schedule: frm.doc.course_schedule\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tfrm.events.get_students(frm, r.message);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tdate: function(frm) {\r\n\t\tfrm.trigger(\"student_group\");\r\n\t},\r\n\r\n\tcourse_schedule: function(frm) {\r\n\t\tfrm.trigger(\"student_group\");\r\n\t},\r\n\r\n\tget_students: function(frm, students) {\r\n\t\tif (!frm.students_area) {\r\n\t\t\tfrm.students_area \u003d $(\u0027\u003cdiv\u003e\u0027)\r\n\t\t\t\t.appendTo(frm.fields_dict.students_html.wrapper);\r\n\t\t}\r\n\t\tstudents \u003d students || [];\r\n\t\tfrm.students_editor \u003d new schools.StudentsEditor(frm, frm.students_area, students)\r\n\t}\r\n});\r\n\r\n\r\nschools.StudentsEditor \u003d Class.extend({\r\n\tinit: function(frm, wrapper, students) {\r\n\t\tthis.wrapper \u003d wrapper;\r\n\t\tthis.frm \u003d frm;\r\n\t\tif(students.length \u003e 0) {\r\n\t\t\tthis.make(frm, students);\r\n\t\t} else {\r\n\t\t\tthis.show_empty_state();\r\n\t\t}\r\n\t},\r\n\tmake: function(frm, students) {\r\n\t\tvar me \u003d this;\r\n\r\n\t\t$(this.wrapper).empty();\r\n\t\tvar student_toolbar \u003d $(\u0027\u003cp\u003e\\\r\n\t\t\t\u003cbutton class\u003d\"btn btn-default btn-add btn-xs\" style\u003d\"margin-right: 5px;\"\u003e\u003c/button\u003e\\\r\n\t\t\t\u003cbutton class\u003d\"btn btn-xs btn-default btn-remove\" style\u003d\"margin-right: 5px;\"\u003e\u003c/button\u003e\\\r\n\t\t\t\u003cbutton class\u003d\"btn btn-default btn-primary btn-mark-att btn-xs\"\u003e\u003c/button\u003e\u003c/p\u003e\u0027).appendTo($(this.wrapper));\r\n\r\n\t\tstudent_toolbar.find(\".btn-add\")\r\n\t\t\t.html(__(\u0027Check all\u0027))\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\t$(me.wrapper).find(\u0027input[type\u003d\"checkbox\"]\u0027).each(function(i, check) {\r\n\t\t\t\t\tif (!$(check).prop(\"disabled\")) {\r\n\t\t\t\t\t\tcheck.checked \u003d true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\tstudent_toolbar.find(\".btn-remove\")\r\n\t\t\t.html(__(\u0027Uncheck all\u0027))\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\t$(me.wrapper).find(\u0027input[type\u003d\"checkbox\"]\u0027).each(function(i, check) {\r\n\t\t\t\t\tif (!$(check).prop(\"disabled\")) {\r\n\t\t\t\t\t\tcheck.checked \u003d false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\tstudent_toolbar.find(\".btn-mark-att\")\r\n\t\t\t.html(__(\u0027Mark Attendance\u0027))\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", true);\r\n\t\t\t\tvar studs \u003d [];\r\n\t\t\t\t$(me.wrapper.find(\u0027input[type\u003d\"checkbox\"]\u0027)).each(function(i, check) {\r\n\t\t\t\t\tvar $check \u003d $(check);\r\n\t\t\t\t\tstuds.push({\r\n\t\t\t\t\t\tstudent: $check.data().student,\r\n\t\t\t\t\t\tstudent_name: $check.data().studentName,\r\n\t\t\t\t\t\tgroup_roll_number: $check.data().group_roll_number,\r\n\t\t\t\t\t\tdisabled: $check.prop(\"disabled\"),\r\n\t\t\t\t\t\tchecked: $check.is(\":checked\")\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar students_present \u003d studs.filter(function(stud) {\r\n\t\t\t\t\treturn !stud.disabled \u0026\u0026 stud.checked;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar students_absent \u003d studs.filter(function(stud) {\r\n\t\t\t\t\treturn !stud.disabled \u0026\u0026 !stud.checked;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfrappe.confirm(__(\"Do you want to update attendance?\u003cbr\u003ePresent: {0}\\\r\n\t\t\t\t\t\u003cbr\u003eAbsent: {1}\", [students_present.length, students_absent.length]),\r\n\t\t\t\t\tfunction() {\t//ifyes\r\n\t\t\t\t\t\tif(!frappe.request.ajax_count) {\r\n\t\t\t\t\t\t\tfrappe.call({\r\n\t\t\t\t\t\t\t\tmethod: \"erpnext.schools.api.mark_attendance\",\r\n\t\t\t\t\t\t\t\tfreeze: true,\r\n\t\t\t\t\t\t\t\tfreeze_message: \"Marking attendance\",\r\n\t\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\t\t\"students_present\": students_present,\r\n\t\t\t\t\t\t\t\t\t\"students_absent\": students_absent,\r\n\t\t\t\t\t\t\t\t\t\"student_group\": frm.doc.student_group,\r\n\t\t\t\t\t\t\t\t\t\"course_schedule\": frm.doc.course_schedule,\r\n\t\t\t\t\t\t\t\t\t\"date\": frm.doc.date\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tfrm.trigger(\"student_group\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction() {\t//ifno\r\n\t\t\t\t\t\t$(me.wrapper.find(\".btn-mark-att\")).attr(\"disabled\", false);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\tvar htmls \u003d students.map(function(student) {\r\n\t\t\treturn frappe.render_template(\"student_button\", {\r\n\t\t\t\tstudent: student.student,\r\n\t\t\t\tstudent_name: student.student_name,\r\n\t\t\t\tgroup_roll_number: student.group_roll_number,\r\n\t\t\t\tstatus: student.status\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t\t$(htmls.join(\"\")).appendTo(me.wrapper);\r\n\t},\r\n\r\n\tshow_empty_state: function() {\r\n\t\t$(this.wrapper).html(\r\n\t\t\t`\u003cdiv class\u003d\"text-center text-muted\" style\u003d\"line-height: 100px;\"\u003e\r\n\t\t\t\t${__(\"No Students in\")} ${this.frm.doc.student_group}\r\n\t\t\t\u003c/div\u003e`\r\n\t\t);\r\n\t}\r\n});"}],"user_settings":"{}"}